(function(){let o=window.require("fs"),l=window.require("process"),d=l.platform,u=("win32"===d?l.env.APPDATA:"darwin"===d?l.env.HOME+"/Library/Preferences":process.env.HOME+"/.config")+"/BetterDiscord/",h="localStorage.json",g={};if(o.existsSync(`${u}${h}`))try{g=JSON.parse(o.readFileSync(`${u}${h}`))}catch(C){console.log(C)}else if(o.existsSync(h))try{g=JSON.parse(o.readFileSync(h))}catch(C){console.log(C)}var y=g;y.setItem=function(C,S){y[C]=S,this.save()},y.getItem=function(C){return y[C]||null},y.save=function(){o.writeFileSync(`${u}${h}`,JSON.stringify(this),null,4)};var E=new Proxy(y,{set:function(C,S,x){y[S]=x,y.save()},get:function(C,S){return y[S]||null}});window.localStorage=E})(),(()=>{let o=document.createElement("div");o.className="bd-loaderv2",o.title="BetterDiscord is loading...",document.body.appendChild(o)})();var DataStore=(()=>{const o=require("fs"),l=require("path"),d=DiscordNative.globals.releaseChannel;return new class{constructor(){this.data={settings:{stable:{},canary:{},ptb:{}}},this.pluginData={}}initialize(){if(o.existsSync(this.BDFile)?this.data=require(this.BDFile):o.writeFileSync(this.BDFile,JSON.stringify(this.data,null,4)),!!o.existsSync(this.settingsFile)){let h=require(this.settingsFile);o.unlinkSync(this.settingsFile),h=h.hasOwnProperty("settings")?Object.assign({stable:{},canary:{},ptb:{}},{[d]:h}):Object.assign({stable:{},canary:{},ptb:{}},h),this.setBDData("settings",h)}}get BDFile(){return this._BDFile||(this._BDFile=l.resolve(bdConfig.dataPath,"bdstorage.json"))}get settingsFile(){return this._settingsFile||(this._settingsFile=l.resolve(bdConfig.dataPath,"bdsettings.json"))}getPluginFile(h){return l.resolve(ContentManager.pluginsFolder,h+".config.json")}getSettingGroup(h){return this.data.settings[d][h]||null}setSettingGroup(h,g){this.data.settings[d][h]=g,o.writeFileSync(this.BDFile,JSON.stringify(this.data,null,4))}getBDData(h){return this.data[h]||""}setBDData(h,g){this.data[h]=g,o.writeFileSync(this.BDFile,JSON.stringify(this.data,null,4))}getPluginData(h,g){return void 0===this.pluginData[h]?o.existsSync(this.getPluginFile(h))?(this.pluginData[h]=JSON.parse(o.readFileSync(this.getPluginFile(h))),this.pluginData[h][g]||void 0):void 0:this.pluginData[h][g]||void 0}setPluginData(h,g,y){void 0===y||(this.pluginData[h]===void 0&&(this.pluginData[h]={}),this.pluginData[h][g]=y,o.writeFileSync(this.getPluginFile(h),JSON.stringify(this.pluginData[h],null,4)))}deletePluginData(h,g){this.pluginData[h]===void 0&&(this.pluginData[h]={}),delete this.pluginData[h][g],o.writeFileSync(this.getPluginFile(h),JSON.stringify(this.pluginData[h],null,4))}}})();window.bdStorage=class{static get(l){return Utils.warn("[Deprecation Notice] Please use BdApi.getBDData(). bdStorage may be removed in future versions."),DataStore.getBDData(l)}static set(l,d){Utils.warn("[Deprecation Notice] Please use BdApi.setBDData(). bdStorage may be removed in future versions."),DataStore.setBDData(l,d)}},window.bdPluginStorage=class{static get(l,d){return Utils.warn(`[Deprecation Notice] Please use BdApi.loadData() or BdApi.getData(). bdPluginStorage may be removed in future versions.`),DataStore.getPluginData(l,d)||null}static set(l,d,u){return Utils.warn("[Deprecation Notice] Please use BdApi.saveData() or BdApi.setData(). bdPluginStorage may be removed in future versions."),"undefined"==typeof value?Utils.warn("Trying to set undefined value in plugin "+l):void DataStore.setPluginData(l,d,u)}static delete(l,d){Utils.warn("[Deprecation Notice] Please use BdApi.deleteData(). bdPluginStorage may be removed in future versions."),DataStore.deletePluginData(l,d)}};var settingsPanel,emoteModule,quickEmoteMenu,voiceMode,pluginModule,themeModule,dMode,publicServersModule,minSupportedVersion="0.3.0",bbdVersion="0.2.2",mainCore,settings={"Save logs locally":{id:"bda-gs-0",info:"Saves chat logs locally",implemented:!1,hidden:!1,cat:"core"},"Public Servers":{id:"bda-gs-1",info:"Display public servers button",implemented:!0,hidden:!1,cat:"core"},"Minimal Mode":{id:"bda-gs-2",info:"Hide elements and reduce the size of elements.",implemented:!0,hidden:!1,cat:"core"},"Voice Mode":{id:"bda-gs-4",info:"Only show voice chat",implemented:!0,hidden:!1,cat:"core"},"Hide Channels":{id:"bda-gs-3",info:"Hide channels in minimal mode",implemented:!0,hidden:!1,cat:"core"},"Dark Mode":{id:"bda-gs-5",info:"Make certain elements dark by default(wip)",implemented:!0,hidden:!1,cat:"core"},"Override Default Emotes":{id:"bda-es-5",info:"Override default emotes",implemented:!1,hidden:!1,cat:"core"},"Voice Disconnect":{id:"bda-dc-0",info:"Disconnect from voice server when closing Discord",implemented:!0,hidden:!1,cat:"core"},"Custom css live update":{id:"bda-css-0",info:"",implemented:!0,hidden:!0,cat:"core"},"Custom css auto udpate":{id:"bda-css-1",info:"",implemented:!0,hidden:!0,cat:"core"},"24 Hour Timestamps":{id:"bda-gs-6",info:"Replace 12hr timestamps with proper ones",implemented:!0,hidden:!1,cat:"core"},"Coloured Text":{id:"bda-gs-7",info:"Make text colour the same as role colour",implemented:!0,hidden:!1,cat:"core"},"BetterDiscord Blue":{id:"bda-gs-b",info:"Replace Discord blue with BD Blue",implemented:!0,hidden:!1,cat:"core"},"Developer Mode":{id:"bda-gs-8",info:"Developer Mode",implemented:!0,hidden:!1,cat:"core"},"Startup Error Modal":{id:"fork-ps-1",info:"Show a modal with plugin/theme errors on startup",implemented:!0,hidden:!1,cat:"fork"},"Show Toasts":{id:"fork-ps-2",info:"Shows a small notification for important information",implemented:!0,hidden:!1,cat:"fork"},"Scroll To Settings":{id:"fork-ps-3",info:"Auto-scrolls to a plugin's settings when the button is clicked (only if out of view)",implemented:!0,hidden:!1,cat:"fork"},"Animate On Hover":{id:"fork-es-2",info:"Only animate the emote modifiers on hover",implemented:!0,hidden:!1,cat:"fork"},"Copy Selector":{id:"fork-dm-1",info:"Adds a \"Copy Selector\" option to context menus when developer mode is active",implemented:!0,hidden:!1,cat:"fork"},"Download Emotes":{id:"fork-es-3",info:"Download emotes when the cache is expired",implemented:!0,hidden:!1,cat:"fork"},"Normalize Classes":{id:"fork-ps-4",info:"Adds stable classes to elements to help themes. (e.g. adds .da-channels to .channels-Ie2l6A)",implemented:!0,hidden:!1,cat:"fork"},"Automatic Loading":{id:"fork-ps-5",info:"Automatically loads, reloads, and unloads plugins and themes",implemented:!0,hidden:!1,cat:"fork"},"Enable Transparency":{id:"fork-wp-1",info:"Enables the main window to be see-through (requires restart)",implemented:!0,hidden:!1,cat:"fork"},"Window Frame":{id:"fork-wp-2",info:"Adds the native os window frame to the main window",implemented:!1,hidden:!0,cat:"fork"},"Twitch Emotes":{id:"bda-es-7",info:"Show Twitch emotes",implemented:!0,hidden:!1,cat:"emote"},"FrankerFaceZ Emotes":{id:"bda-es-1",info:"Show FrankerFaceZ Emotes",implemented:!0,hidden:!1,cat:"emote"},"BetterTTV Emotes":{id:"bda-es-2",info:"Show BetterTTV Emotes",implemented:!0,hidden:!1,cat:"emote"},"Emote Menu":{id:"bda-es-0",info:"Show Twitch/Favourite emotes in emote menu",implemented:!0,hidden:!1,cat:"emote"},"Emoji Menu":{id:"bda-es-9",info:"Show Discord emoji menu",implemented:!0,hidden:!1,cat:"emote"},"Emote Autocomplete":{id:"bda-es-3",info:"Autocomplete emote commands",implemented:!1,hidden:!1,cat:"emote"},"Emote Auto Capitalization":{id:"bda-es-4",info:"Autocapitalize emote commands",implemented:!0,hidden:!1,cat:"emote"},"Show Names":{id:"bda-es-6",info:"Show emote names on hover",implemented:!0,hidden:!1,cat:"emote"},"Show emote modifiers":{id:"bda-es-8",info:"Enable emote mods (flip, spin, pulse, spin2, spin3, 1spin, 2spin, 3spin, tr, bl, br, shake, shake2, shake3, flap)",implemented:!0,hidden:!1,cat:"emote"}},defaultCookie={"bda-gs-0":!1,"bda-gs-1":!0,"bda-gs-2":!1,"bda-gs-3":!1,"bda-gs-4":!1,"bda-gs-5":!0,"bda-gs-6":!1,"bda-gs-7":!1,"bda-gs-8":!1,"bda-es-0":!0,"bda-es-1":!0,"bda-es-2":!0,"bda-es-3":!1,"bda-es-4":!1,"bda-es-5":!0,"bda-es-6":!0,"bda-es-7":!0,"bda-gs-b":!1,"bda-es-8":!0,"bda-dc-0":!1,"bda-css-0":!1,"bda-css-1":!1,"bda-es-9":!0,"fork-dm-1":!1,"fork-ps-1":!0,"fork-ps-2":!0,"fork-ps-3":!0,"fork-ps-4":!0,"fork-ps-5":!0,"fork-es-2":!1,"fork-es-3":!0,"fork-wp-1":!1,"fork-wp-2":!1},settingsCookie={},bdpluginErrors=[],bdthemeErrors=[],bdConfig=null;function Core(o){window.bdConfig=o}var classNormalizer;Core.prototype.init=async function(){return bdConfig.version<minSupportedVersion?void this.alert("Not Supported","BetterDiscord v"+bdConfig.version+" (your version) is not supported by the latest js ("+bbdVersion+").<br><br> Please download the latest version from <a href='https://github.com/rauenzi/BetterDiscordApp/releases/latest' target='_blank'>GitHub</a>"):void(bdConfig.updater.LatestVersion>bdConfig.version&&this.alert("Update Available",`
            An update for BandagedBD is available (${bdConfig.updater.LatestVersion})! Please Reinstall!<br /><br />
            <a href='https://github.com/rauenzi/BetterDiscordApp/releases/latest' target='_blank'>Download Installer</a>
        `),Utils.log("Initializing Settings"),this.initSettings(),classNormalizer=new ClassNormalizer,emoteModule=new EmoteModule,quickEmoteMenu=new QuickEmoteMenu,Utils.log("Initializing EmoteModule"),window.emotePromise=emoteModule.init().then(()=>{emoteModule.initialized=!0,Utils.log("Initializing QuickEmoteMenu"),quickEmoteMenu.init()}),publicServersModule=new V2_PublicServers,voiceMode=new VoiceMode,dMode=new devMode,this.injectExternals(),await this.checkForGuilds(),Utils.log("Updating Settings"),settingsPanel=new V2_SettingsPanel,settingsPanel.updateSettings(),Utils.log("Loading Plugins"),pluginModule=new PluginModule,pluginModule.loadPlugins(),Utils.log("Loading Themes"),themeModule=new ThemeModule,themeModule.loadThemes(),$("#customcss").detach().appendTo(document.head),window.addEventListener("beforeunload",function(){settingsCookie["bda-dc-0"]&&document.querySelector(".btn.btn-disconnect").click()}),publicServersModule.initialize(),emoteModule.autoCapitalize(),Utils.log("Removing Loading Icon"),document.getElementsByClassName("bd-loaderv2")[0].remove(),Utils.log("Initializing Main Observer"),this.initObserver(),settingsCookie["fork-ps-1"]&&(Utils.log("Collecting Startup Errors"),this.showStartupErrors({plugins:bdpluginErrors,themes:bdthemeErrors})),!DataStore.getBDData("RNMAnnouncement")&&(DataStore.setBDData("RNMAnnouncement",!0),this.alert("Significant Changes",`
            The lastest release of BBD has made a lot of improvements including being able to automatically load, unload, and reload plugins and themes.<br /><br />
            If you had the RestartNoMore plugin, I suggest removing it (or turning off BBD's loader in settings) so things aren't being loaded multiple times.
        `)))},Core.prototype.checkForGuilds=function(){return new Promise(o=>{const l=function(){return 0<document.querySelectorAll(`.${BDV2.guildClasses.guilds} .${BDV2.guildClasses.guild}`).length?o(bdConfig.deferLoaded=!0):void setTimeout(l,100)};$(document).ready(function(){setTimeout(l,100)})})},Core.prototype.injectExternals=function(){Utils.injectJs("https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.9/ace.js")},Core.prototype.initSettings=function(){if(DataStore.initialize(),!DataStore.getSettingGroup("settings"))settingsCookie=defaultCookie,this.saveSettings();else for(var o in this.loadSettings(),$("<style id=\"customcss\">").html(atob(DataStore.getBDData("bdcustomcss"))).appendTo(document.head),defaultCookie)void 0==settingsCookie[o]&&(settingsCookie[o]=defaultCookie[o],this.saveSettings())},Core.prototype.saveSettings=function(){DataStore.setSettingGroup("settings",settingsCookie)},Core.prototype.loadSettings=function(){settingsCookie=DataStore.getSettingGroup("settings")},Core.prototype.initObserver=function(){const o=new MutationObserver(l=>{for(let h,d=0,u=l.length;d<u;d++)if(h=l[d],"undefined"!=typeof pluginModule&&pluginModule.rawObserver(h),h.addedNodes.length&&h.addedNodes[0]instanceof Element){let y=h.addedNodes[0];y.classList.contains("layer-3QrUeG")&&(y.getElementsByClassName("guild-settings-base-section").length&&y.setAttribute("layer-id","server-settings"),y.getElementsByClassName("socialLinks-3jqNFy").length&&(y.setAttribute("layer-id","user-settings"),y.setAttribute("id","user-settings"),!document.getElementById("bd-settings-sidebar")&&settingsPanel.renderSidebar())),y.classList.contains("popout-3sVMXz")&&!y.classList.contains("popoutLeft-30WmrD")&&y.getElementsByClassName("emojiPicker-3m1S-j").length&&quickEmoteMenu.obsCallback(y)}});o.observe(document,{childList:!0,subtree:!0})},Core.prototype.inject24Hour=function(){if(!this.cancel24Hour){const o=/([0-9]{1,2}):([0-9]{1,2})\s(AM|PM)/;this.cancel24Hour=Utils.monkeyPatch(BDV2.TimeFormatter,"calendarFormat",{after:l=>{if(settingsCookie["bda-gs-6"]){const d=l.returnValue.match(o);return d&&4===d.length?"AM"===d[3]?l.returnValue=l.returnValue.replace(d[0],`${"12"===d[1]?"00":d[1].padStart(2,"0")}:${d[2]}`):l.returnValue=l.returnValue.replace(d[0],`${"12"===d[1]?"12":parseInt(d[1])+12}:${d[2]}`):void 0}}})}},Core.prototype.injectColoredText=function(){this.cancelColoredText||(this.cancelColoredText=Utils.monkeyPatch(BDV2.MessageContentComponent.prototype,"render",{after:o=>{settingsCookie["bda-gs-7"]&&Utils.monkeyPatch(o.returnValue.props,"children",{silent:!0,after:({returnValue:l})=>{const d=l.props.children[1],u=o.thisObject.props.message.colorString;return d&&u&&(d.props.style={color:u}),l}})}}))},Core.prototype.removeColoredText=function(){document.querySelectorAll(".markup-2BOw-j").forEach(o=>{o.style.setProperty("color","")})},Core.prototype.alert=function(o,l){let d=$(`<div class="bd-modal-wrapper theme-dark">
                    <div class="bd-backdrop backdrop-1wrmKB"></div>
                    <div class="bd-modal modal-1UGdnR">
                        <div class="bd-modal-inner inner-1JeGVc">
                            <div class="header header-1R_AjF">
                                <div class="title">${o}</div>
                            </div>
                            <div class="bd-modal-body">
                                <div class="scroller-wrap fade">
                                    <div class="scroller">
                                        ${l}
                                    </div>
                                </div>
                            </div>
                            <div class="footer footer-2yfCgX">
                                <button type="button">Okay</button>
                            </div>
                        </div>
                    </div>
                </div>`);d.find(".footer button").on("click",()=>{d.addClass("closing"),setTimeout(()=>{d.remove()},300)}),d.find(".bd-backdrop").on("click",()=>{d.addClass("closing"),setTimeout(()=>{d.remove()},300)}),d.appendTo("#app-mount")},Core.prototype.showStartupErrors=function({plugins:o,themes:l}){function d(g){let y=$(`<div class="errors">`);for(let E of g){let C=$(`<div class="error">
                                <div class="table-column column-name">${E.name?E.name:E.file}</div>
                                <div class="table-column column-reason">${E.reason}</div>
                                <div class="table-column column-error"><a class="error-link" href="">${E.error?E.error.message:""}</a></div>
                            </div>`);y.append(C),E.error&&C.find("a").on("click",S=>{S.preventDefault(),Utils.err(`Error details for ${E.name?E.name:E.file}.`,E.error)})}return y}if(o&&l&&(o.length||l.length)){let u=$(`<div class="bd-modal-wrapper theme-dark">
                    <div class="bd-backdrop backdrop-1wrmKB"></div>
                    <div class="bd-modal bd-startup-modal modal-1UGdnR">
                        <div class="bd-modal-inner inner-1JeGVc">
                            <div class="header header-1R_AjF"><div class="title">Startup Errors</div></div>
                            <div class="bd-modal-body">
                                <div class="tab-bar-container">
                                    <div class="tab-bar TOP">
                                        <div class="tab-bar-item">Plugins</div>
                                        <div class="tab-bar-item">Themes</div>
                                    </div>
                                </div>
                                <div class="table-header">
                                    <div class="table-column column-name">Name</div>
                                    <div class="table-column column-reason">Reason</div>
                                    <div class="table-column column-error">Error</div>
                                </div>
                                <div class="scroller-wrap fade">
                                    <div class="scroller">

                                    </div>
                                </div>
                            </div>
                            <div class="footer footer-2yfCgX">
                                <button type="button">Okay</button>
                            </div>
                        </div>
                    </div>
                </div>`),h=[d(o),d(l)];u.find(".tab-bar-item").on("click",g=>{g.preventDefault(),u.find(".tab-bar-item").removeClass("selected"),$(g.target).addClass("selected"),u.find(".scroller").empty().append(h[$(g.target).index()])}),u.find(".footer button").on("click",()=>{u.addClass("closing"),setTimeout(()=>{u.remove()},300)}),u.find(".bd-backdrop").on("click",()=>{u.addClass("closing"),setTimeout(()=>{u.remove()},300)}),u.appendTo("#app-mount"),o.length?u.find(".tab-bar-item")[0].click():u.find(".tab-bar-item")[1].click()}},Core.prototype.showToast=function(o,l={}){if(bdConfig.deferLoaded){if(!document.querySelector(".bd-toasts")){let y=document.createElement("div");y.classList.add("bd-toasts");let E=document.querySelector(".chat-3bRxxu form, #friends, .noChannel-Z1DQK7, .activityFeed-28jde9");y.style.setProperty("left",E?E.getBoundingClientRect().left+"px":"0px"),y.style.setProperty("width",E?E.offsetWidth+"px":"100%"),y.style.setProperty("bottom",(document.querySelector(".chat-3bRxxu form")?document.querySelector(".chat-3bRxxu form").offsetHeight:80)+"px"),document.querySelector(".app").appendChild(y)}const{type:d="",icon:u=!0,timeout:h=3e3}=l;let g=document.createElement("div");g.classList.add("bd-toast"),d&&g.classList.add("toast-"+d),d&&u&&g.classList.add("icon"),g.innerText=o,document.querySelector(".bd-toasts").appendChild(g),setTimeout(()=>{g.classList.add("closing"),setTimeout(()=>{g.remove(),document.querySelectorAll(".bd-toasts .bd-toast").length||document.querySelector(".bd-toasts").remove()},300)},h)}},window.emotesFfz={},window.emotesBTTV={},window.emotesBTTV2={},window.emotesTwitch={},window.subEmotesTwitch={},window.bdEmotes={TwitchGlobal:{},TwitchSubscriber:{},BTTV:{},FrankerFaceZ:{},BTTV2:{}},window.bdEmoteSettingIDs={TwitchGlobal:"bda-es-7",TwitchSubscriber:"bda-es-7",BTTV:"bda-es-2",FrankerFaceZ:"bda-es-1",BTTV2:"bda-es-2"};function EmoteModule(){}EmoteModule.prototype.init=async function(){this.modifiers=["flip","spin","pulse","spin2","spin3","1spin","2spin","3spin","tr","bl","br","shake","shake2","shake3","flap"],this.overrides=["twitch","bttv","ffz"],this.categories=["TwitchGlobal","TwitchSubscriber","BTTV","BTTV2","FrankerFaceZ"];let o={TwitchGlobal:{url:"https://twitchemotes.com/api_cache/v3/global.json",backup:"https://cdn.staticaly.com/gh/rauenzi/BetterDiscordApp/master/data/emotedata_twitch_global.json",variable:"TwitchGlobal",oldVariable:"emotesTwitch",getEmoteURL:l=>`https://static-cdn.jtvnw.net/emoticons/v1/${l.id}/1.0`,getOldData:(l,d)=>{return{id:l.match(/\/([0-9]+)\//)[1],code:d,emoticon_set:0,description:null}}},TwitchSubscriber:{url:"https://twitchemotes.com/api_cache/v3/subscriber.json",backup:"https://cdn.staticaly.com/gh/rauenzi/BetterDiscordApp/master/data/emotedata_twitch_subscriber.json",variable:"TwitchSubscriber",oldVariable:"subEmotesTwitch",parser:l=>{let d={};for(let u in l){let h=l[u];for(let E,g=0,y=h.emotes.length;g<y;g++)E=h.emotes[g],d[E.code]=E.id}return d},backupParser:l=>{return l},getEmoteURL:l=>`https://static-cdn.jtvnw.net/emoticons/v1/${l}/1.0`,getOldData:l=>l.match(/\/([0-9]+)\//)[1]},FrankerFaceZ:{url:"https://cdn.staticaly.com/gh/rauenzi/BetterDiscordApp/master/data/emotedata_ffz.json",variable:"FrankerFaceZ",oldVariable:"emotesFfz",getEmoteURL:l=>`https://cdn.frankerfacez.com/emoticon/${l}/1`,getOldData:l=>l.match(/\/([0-9]+)\//)[1]},BTTV:{url:"https://api.betterttv.net/emotes",variable:"BTTV",oldVariable:"emotesBTTV",parser:l=>{let d={};for(let g,u=0,h=l.emotes.length;u<h;u++)g=l.emotes[u],d[g.regex]=g.url;return d},getEmoteURL:l=>`${l}`,getOldData:l=>l},BTTV2:{url:"https://cdn.staticaly.com/gh/rauenzi/BetterDiscordApp/master/data/emotedata_bttv.json",variable:"BTTV2",oldVariable:"emotesBTTV2",getEmoteURL:l=>`https://cdn.betterttv.net/emote/${l}/1x`,getOldData:l=>l.match(/emote\/(.+)\//)[1]}};for(await this.getBlacklist(),await this.loadEmoteData(o);!BDV2.MessageContentComponent;)await new Promise(l=>setTimeout(l,100));this.cancelEmoteRender||(this.cancelEmoteRender=Utils.monkeyPatch(BDV2.MessageContentComponent.prototype,"render",{after:({returnValue:l})=>{Utils.monkeyPatch(l.props,"children",{silent:!0,after:({returnValue:d})=>{const u=d.props.children[1];if(u.props.children){const h=u.props.children[1];if(h&&h.length){for(let y=0;y<h.length;y++){const E=h[y];if("string"==typeof E){const I=E.split(/([^\s]+)([\s]|$)/g);for(let G=0,W=this.categories.length;G<W;G++)for(let q=0,z=I.length;q<z;q++){let V=I[q],U=V.split(":"),H=U[0],J=U[1]?U[1]:"",Z=J.slice(0);if(!(bemotes.includes(H)||4>H.length)){this.modifiers.includes(J)&&settingsCookie["bda-es-8"]||(J=""),this.overrides.includes(Z)?J=Z:Z="";let K=this.categories[G];if("twitch"===Z?window.bdEmotes.TwitchGlobal[H]?K="TwitchGlobal":window.bdEmotes.TwitchSubscriber[H]&&(K="TwitchSubscriber"):"bttv"===Z?window.bdEmotes.BTTV[H]?K="BTTV":window.bdEmotes.BTTV2[H]&&(K="BTTV2"):"ffz"==Z&&window.bdEmotes.FrankerFaceZ[H]&&(K="FrankerFaceZ"),window.bdEmotes[K][H]&&settingsCookie[window.bdEmoteSettingIDs[K]]){const Q=h[y].match(new RegExp(`([\\s]|^)${Utils.escape(J?H+":"+J:H)}([\\s]|$)`));if(Q){const Y=h[y].substring(0,Q.index+Q[1].length),X=h[y].substring(Q.index+Q[0].length-Q[2].length);h[y]=Y;const ee=BDV2.react.createElement(BDEmote,{name:H,url:window.bdEmotes[K][H],modifier:J});h.splice(y+1,0,X),h.splice(y+1,0,ee)}}}}}}const g=h.every(y=>{return"string"==typeof y&&""==y.replace(/\s*/,"")||y.type&&"BDEmote"==y.type.name||y.props&&y.props.children&&y.props.children.props&&y.props.children.props.emojiName});if(g)for(let y of h)"object"==typeof y&&("BDEmote"==y.type.name?y.props.jumboable=!0:y.props&&y.props.children&&y.props.children.props&&y.props.children.props.emojiName&&(y.props.children.props.jumboable=!0))}}}})}}))},EmoteModule.prototype.clearEmoteData=async function(){let o=require("fs"),d=bdConfig.dataPath+"emote_data.json",u=o.existsSync(d);u&&o.unlinkSync(d),DataStore.setBDData("emoteCacheDate",new Date().toJSON()),window.bdEmotes={TwitchGlobal:{},TwitchSubscriber:{},BTTV:{},FrankerFaceZ:{},BTTV2:{}}},EmoteModule.prototype.goBack=async function(o){for(let l in o)for(let d in window.bdEmotes[o[l].variable])window[o[l].oldVariable][d]=o[l].getOldData(window.bdEmotes[o[l].variable][d],d)},EmoteModule.prototype.isCacheValid=function(){const o=new Date(DataStore.getBDData("emoteCacheDate")||null),l=new Date,d=Math.round(Math.abs((l.getTime()-o.getTime())/86400000));return!(d>bdConfig.cache.days)||(DataStore.setBDData("emoteCacheDate",l.toJSON()),!1)},EmoteModule.prototype.loadEmoteData=async function(o){const l=require("fs"),u=bdConfig.dataPath+"emote_data.json",h=l.existsSync(u);if(h&&this.isCacheValid()){settingsCookie["fork-ps-2"]&&mainCore.showToast("Loading emotes from cache.",{type:"info"}),Utils.log("[Emotes] Loading emotes from local cache.");const g=await new Promise(E=>{l.readFile(u,"utf8",(C,S)=>{Utils.log("[Emotes] Emotes loaded from cache."),C&&(S={}),E(S)})});let y=Utils.testJSON(g);for(const E in y&&(window.bdEmotes=JSON.parse(g)),o)y=0<Object.keys(window.bdEmotes[o[E].variable]).length;if(y)return void(settingsCookie["fork-ps-2"]&&mainCore.showToast("Emotes successfully loaded.",{type:"success"}));Utils.log("[Emotes] Cache was corrupt, downloading..."),l.unlinkSync(u)}if(!settingsCookie["fork-es-3"])return quickEmoteMenu.init();for(let g in settingsCookie["fork-ps-2"]&&mainCore.showToast("Downloading emotes in the background do not reload.",{type:"info"}),o){await new Promise(E=>setTimeout(E,1e3));let y=await this.downloadEmotes(o[g]);window.bdEmotes[o[g].variable]=y}settingsCookie["fork-ps-2"]&&mainCore.showToast("All emotes successfully downloaded.",{type:"success"});try{l.writeFileSync(u,JSON.stringify(window.bdEmotes),"utf8")}catch(g){Utils.err("[Emotes] Could not save emote data.",g)}quickEmoteMenu.init()},EmoteModule.prototype.downloadEmotes=function(o){let l=require("request"),d={url:o.url,timeout:o.timeout?o.timeout:5e3};return Utils.log("[Emotes] Downloading: "+o.variable),new Promise((u,h)=>{l(d,(g,y,E)=>{if(g)return Utils.err("[Emotes] Could not download "+o.variable,g),o.backup?(o.url=o.backup,o.backup=null,o.backupParser&&(o.parser=o.backupParser),u(this.downloadEmotes(o))):h({});let C={};try{C=JSON.parse(E)}catch(S){return Utils.err("[Emotes] Could not download "+o.variable,g),o.backup?(o.url=o.backup,o.backup=null,o.backupParser&&(o.parser=o.backupParser),u(this.downloadEmotes(o))):h({})}for(let S in"function"==typeof o.parser&&(C=o.parser(C)),C)C[S]=o.getEmoteURL(C[S]);u(C),Utils.log("[Emotes] Downloaded: "+o.variable)})})},EmoteModule.prototype.getBlacklist=function(){return new Promise(o=>{$.getJSON("https://cdn.staticaly.com/gh/rauenzi/BetterDiscordApp/master/data/emotefilter.json",function(l){o(bemotes=l.blacklist)})})};var bemotes=[];EmoteModule.prototype.autoCapitalize=function(){$("body").delegate($(".channelTextArea-1LDbYG textarea:first"),"keyup change paste",()=>{if(settingsCookie["bda-es-4"]){var o=$(".channelTextArea-1LDbYG textarea:first").val();if(void 0!=o){var l=o.split(" ").pop();if(3<l.length){if("danSgame"==l)return;var d=this.capitalize(l.toLowerCase());null!==d&&void 0!==d&&Utils.insertText(Utils.getTextArea()[0],o.replace(l,d))}}}})},EmoteModule.prototype.capitalize=function(o){var l=window.bdEmotes.TwitchGlobal;for(var d in l)if(l.hasOwnProperty(d)&&o==(d+"").toLowerCase())return d};function QuickEmoteMenu(){}QuickEmoteMenu.prototype.init=function(){$(document).on("mousedown",function(g){"rmenu"!=g.target.id&&$("#rmenu").remove()}),this.favoriteEmotes={};var o=DataStore.getBDData("bdfavemotes");""!==o&&null!==o&&(this.favoriteEmotes=JSON.parse(atob(o)));var l="";l+="<div id=\"bda-qem\">",l+="    <button class=\"active\" id=\"bda-qem-twitch\" onclick='quickEmoteMenu.switchHandler(this); return false;'>Twitch</button>",l+="    <button id=\"bda-qem-favourite\" onclick='quickEmoteMenu.switchHandler(this); return false;'>Favourite</button>",l+="    <button id=\"bda-qem-emojis\" onclick='quickEmoteMenu.switchHandler(this); return false;'>Emojis</buttond>",l+="</div>",this.qmeHeader=l;var d="";d+="<div id=\"bda-qem-twitch-container\">",d+="    <div class=\"scroller-wrap fade\">",d+="        <div class=\"scroller\">",d+="            <div class=\"emote-menu-inner\">";var u="";for(let g in window.bdEmotes.TwitchGlobal)window.bdEmotes.TwitchGlobal.hasOwnProperty(g)&&(u=window.bdEmotes.TwitchGlobal[g],d+="<div class=\"emote-container\">",d+="    <img class=\"emote-icon\" alt=\"\" src=\""+u+"\" title=\""+g+"\">",d+="    </img>",d+="</div>");d+="            </div>",d+="        </div>",d+="    </div>",d+="</div>",this.teContainer=d;var h="";for(let g in h+="<div id=\"bda-qem-favourite-container\">",h+="    <div class=\"scroller-wrap fade\">",h+="        <div class=\"scroller\">",h+="            <div class=\"emote-menu-inner\">",this.favoriteEmotes)u=this.favoriteEmotes[g],h+="<div class=\"emote-container\">",h+="    <img class=\"emote-icon\" alt=\"\" src=\""+u+"\" title=\""+g+"\" oncontextmenu='quickEmoteMenu.favContext(event, this);'>",h+="    </img>",h+="</div>";h+="            </div>",h+="        </div>",h+="    </div>",h+="</div>",this.faContainer=h},QuickEmoteMenu.prototype.favContext=function(o,l){o.stopPropagation();var d=$("<div>",{id:"rmenu","data-emoteid":$(l).prop("title"),text:"Remove","class":"context-menu theme-dark"});return d.css({top:o.pageY-$("#bda-qem-favourite-container").offset().top,left:o.pageX-$("#bda-qem-favourite-container").offset().left}),$(l).parent().append(d),d.on("click",function(u){return u.preventDefault(),u.stopPropagation(),$(this).remove(),delete quickEmoteMenu.favoriteEmotes[$(this).data("emoteid")],quickEmoteMenu.updateFavorites(),!1}),!1},QuickEmoteMenu.prototype.switchHandler=function(o){this.switchQem($(o).attr("id"))},QuickEmoteMenu.prototype.switchQem=function(o){var l=$("#bda-qem-twitch"),d=$("#bda-qem-favourite"),u=$("#bda-qem-emojis");l.removeClass("active"),d.removeClass("active"),u.removeClass("active"),$(".emojiPicker-3m1S-j").hide(),$("#bda-qem-favourite-container").hide(),$("#bda-qem-twitch-container").hide();"bda-qem-twitch"===o?(l.addClass("active"),$("#bda-qem-twitch-container").show()):"bda-qem-favourite"===o?(d.addClass("active"),$("#bda-qem-favourite-container").show()):"bda-qem-emojis"===o?(u.addClass("active"),$(".emojiPicker-3m1S-j").show(),$(".emojiPicker-3m1S-j .search-bar-inner input, .emojiPicker-3m1S-j .search-bar-inner input").focus()):void 0;this.lastTab=o;var h=$(".emote-icon");h.off(),h.on("click",function(){var g=$(this).attr("title"),y=Utils.getTextArea();Utils.insertText(y[0]," "==y.val().slice(-1)?y.val()+g:y.val()+" "+g)})},QuickEmoteMenu.prototype.obsCallback=function(o){var l=$(o);settingsCookie["bda-es-9"]?l.removeClass("bda-qme-hidden"):l.addClass("bda-qme-hidden");settingsCookie["bda-es-0"]&&(l.prepend(this.qmeHeader),l.append(this.teContainer),l.append(this.faContainer),this.lastTab==void 0&&(this.lastTab="bda-qem-favourite"),this.switchQem(this.lastTab))},QuickEmoteMenu.prototype.favorite=function(o,l){this.favoriteEmotes.hasOwnProperty(o)||(this.favoriteEmotes[o]=l),this.updateFavorites()},QuickEmoteMenu.prototype.updateFavorites=function(){var o="";for(var l in o+="<div id=\"bda-qem-favourite-container\">",o+="    <div class=\"scroller-wrap fade\">",o+="        <div class=\"scroller\">",o+="            <div class=\"emote-menu-inner\">",this.favoriteEmotes){var d=this.favoriteEmotes[l];o+="<div class=\"emote-container\">",o+="    <img class=\"emote-icon\" alt=\"\" src=\""+d+"\" title=\""+l+"\" oncontextmenu=\"quickEmoteMenu.favContext(event, this);\">",o+="    </img>",o+="</div>"}o+="            </div>",o+="        </div>",o+="    </div>",o+="</div>",this.faContainer=o,$("#bda-qem-favourite-container").replaceWith(o),DataStore.setBDData("bdfavemotes",btoa(JSON.stringify(this.favoriteEmotes)))};var Utils=class{static get screenWidth(){return Math.max(document.documentElement.clientWidth,window.innerWidth||0)}static get screenHeight(){return Math.max(document.documentElement.clientHeight,window.innerHeight||0)}static stripBOM(o){return 65279===o.charCodeAt(0)&&(o=o.slice(1)),o}static getTextArea(){return $(".channelTextArea-1LDbYG textarea")}static insertText(o,l){o.focus(),o.selectionStart=0,o.selectionEnd=o.value.length,document.execCommand("insertText",!1,l)}static injectCss(o){$("<link/>",{type:"text/css",rel:"stylesheet",href:o}).appendTo($("head"))}static injectJs(o){$("<script/>",{type:"text/javascript",src:o}).appendTo($("body"))}static escapeID(o){return o.replace(/^[^a-z]+|[^\w-]+/gi,"")}static log(o){console.log("%c[BetterDiscord] %c"+o+"","color: #3a71c1; font-weight: 700;","")}static warn(o){console.warn("%c[BetterDiscord] %c"+o+"","color: #E8A400; font-weight: 700;","")}static err(o,l){console.log("%c[BetterDiscord] %c"+o+"","color: red; font-weight: 700;",""),l&&(console.groupCollapsed("%cError: "+l.message,"color: red;"),console.error(l.stack),console.groupEnd())}static escape(o){return o.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&")}static testJSON(o){try{return JSON.parse(o),!0}catch(l){return!1}}static suppressErrors(o,l){return(...d)=>{try{return o(...d)}catch(u){console.error("Error occurred in "+l,u)}}}static monkeyPatch(o,l,d){const{before:u,after:h,instead:g,once:y=!1,silent:E=!1,force:C=!1}=d,S=d.displayName||o.displayName||o.name||o.constructor.displayName||o.constructor.name;if(E||console.log("patch",l,"of",S),!o[l])if(C)o[l]=function(){};else return console.error(l,"does not exist for",S);const x=o[l],T=()=>{E||console.log("unpatch",l,"of",S),o[l]=x};return o[l]=function(){const N={thisObject:this,methodArguments:arguments,cancelPatch:T,originalMethod:x,callOriginalMethod:()=>N.returnValue=N.originalMethod.apply(N.thisObject,N.methodArguments)};if(g){const D=Utils.suppressErrors(g,"`instead` callback of "+o[l].displayName)(N);void 0!==D&&(N.returnValue=D)}else u&&Utils.suppressErrors(u,"`before` callback of "+o[l].displayName)(N),N.callOriginalMethod(),h&&Utils.suppressErrors(h,"`after` callback of "+o[l].displayName)(N);return y&&T(),N.returnValue},o[l].__monkeyPatched=!0,o[l].displayName="patched "+(o[l].displayName||l),T}static onRemoved(o,l){const d=new MutationObserver(u=>{for(let h=0;h<u.length;h++){const g=u[h],y=Array.from(g.removedNodes),E=-1<y.indexOf(o),C=y.some(S=>S.contains(o));(E||C)&&(d.disconnect(),l())}});d.observe(document.body,{subtree:!0,childList:!0})}};function VoiceMode(){}VoiceMode.prototype.enable=function(){$(".scroller.guild-channels ul").first().css("display","none"),$(".scroller.guild-channels header").first().css("display","none"),$(".app.flex-vertical").first().css("overflow","hidden"),$(".chat-3bRxxu").first().css("visibility","hidden").css("min-width","0px"),$(".flex-vertical.channels-wrap").first().css("flex-grow","100000"),$(".guild-header .btn.btn-hamburger").first().css("visibility","hidden")},VoiceMode.prototype.disable=function(){$(".scroller.guild-channels ul").first().css("display",""),$(".scroller.guild-channels header").first().css("display",""),$(".app.flex-vertical").first().css("overflow",""),$(".chat-3bRxxu").first().css("visibility","").css("min-width",""),$(".flex-vertical.channels-wrap").first().css("flex-grow",""),$(".guild-header .btn.btn-hamburger").first().css("visibility","")},window.bdthemes={},window.bdplugins={};var ContentManager=(()=>{const o=require("path"),l=require("fs"),d=require("module").Module;d.globalPaths.push(o.resolve(require("electron").remote.app.getAppPath(),"node_modules"));class u extends Error{constructor(y){super(y),this.name="MetaError"}}const h=require("module").Module._extensions[".js"],g=d._extensions[".css"]?d._extensions[".css"]:()=>{return null};return new class{constructor(){this.timeCache={},this.watchers={},d._extensions[".js"]=this.getContentRequire("plugin"),d._extensions[".css"]=this.getContentRequire("theme")}get pluginsFolder(){return this._pluginsFolder||(this._pluginsFolder=l.realpathSync(o.resolve(bdConfig.dataPath+"plugins/")))}get themesFolder(){return this._themesFolder||(this._themesFolder=l.realpathSync(o.resolve(bdConfig.dataPath+"themes/")))}watchContent(E){if(!this.watchers[E]){const C="plugin"===E,S=C?this.pluginsFolder:this.themesFolder,x=C?".plugin.js":".theme.css";this.watchers[E]=l.watch(S,{persistent:!1},async(T,N)=>{if(T&&N&&N.endsWith(x)){await new Promise(P=>setTimeout(P,50));try{l.lstatSync(o.resolve(S,N))}catch(P){return"ENOENT"===P.code?(delete this.timeCache[N],C?pluginModule.unloadPlugin(Object.values(bdplugins).find(F=>F.filename==N).plugin.getName()):themeModule.unloadTheme(Object.values(bdthemes).find(F=>F.filename==N).name)):void 0}if(l.lstatSync(o.resolve(S,N)).isFile()){const D=l.lstatSync(o.resolve(S,N));D&&D.mtime&&D.mtime.getTime()&&"number"==typeof D.mtime.getTime()&&this.timeCache[N]!=D.mtime.getTime()&&(this.timeCache[N]=D.mtime.getTime(),"rename"==T&&(C?pluginModule.loadPlugin(N):themeModule.loadTheme(N)),"change"==T&&(C?pluginModule.reloadPlugin(Object.values(bdplugins).find(P=>P.filename==N).plugin.getName()):themeModule.reloadTheme(Object.values(bdthemes).find(P=>P.filename==N).name)))}}})}}unwatchContent(E){this.watchers[E]&&(this.watchers[E].close(),delete this.watcher[E])}extractMeta(E){const C=E.split("\n")[0],S=C.substring(C.lastIndexOf("//META")+6,C.lastIndexOf("*//"));if(0>C.indexOf("META"))throw new u("META was not found.");if(!Utils.testJSON(S))throw new u("META could not be parsed.");const x=JSON.parse(S);if(!x.name)throw new u("META missing name data.");return x}getContentRequire(E){const C="plugin"===E,S=this,x=C?h:g;return function(T,N){if(o.dirname(N)!==(C?S.pluginsFolder:S.themesFolder))return Reflect.apply(x,this,arguments);let D=l.readFileSync(N,"utf8");D=Utils.stripBOM(D);const P=S.extractMeta(D);P.filename=o.basename(N),C||(P.css=D.split("\n").slice(1).join("\n"),D=`module.exports = ${JSON.stringify(P)};`),C&&(D+=`\nmodule.exports = ${JSON.stringify(P)};\nmodule.exports.type = ${P.name};`),T._compile(D,N)}}makePlaceholderPlugin(E){return{plugin:{start:()=>{},getName:()=>{return E.name||E.filename},getAuthor:()=>{return"???"},getDescription:()=>{return E.message?E.message:"This plugin was unable to be loaded. Check the author's page for updates."},getVersion:()=>{return"???"}},name:E.name||E.filename,filename:E.filename,source:E.source?E.source:"",website:E.website?E.website:""}}loadContent(E,C){if("undefined"!=typeof E&&"undefined"!=typeof C){const S="plugin"===C,x=S?this.pluginsFolder:this.themesFolder;try{require(o.resolve(x,E))}catch(N){return{name:E,file:E,reason:"Could not be compiled.",error:{message:N.message,stack:N.stack}}}const T=require(o.resolve(x,E));if(S){if(!T.type)return;try{T.plugin=new T.type,delete bdplugins[T.plugin.getName()],bdplugins[T.plugin.getName()]=T}catch(N){return{name:E,file:E,reason:"Could not be constructed.",error:{message:N.message,stack:N.stack}}}}else delete bdthemes[T.name],bdthemes[T.name]=T}}unloadContent(E,C){if("undefined"!=typeof E&&"undefined"!=typeof C){const x="plugin"===C?this.pluginsFolder:this.themesFolder;try{delete require.original.cache[require.original.resolve(o.resolve(x,E))]}catch(T){return T}}}isLoaded(E,C){const x="plugin"===C?this.pluginsFolder:this.themesFolder;try{require.original.cache[require.original.resolve(o.resolve(x,E))]}catch(T){return!1}return!0}reloadContent(E,C){return this.unloadContent(E,C)?void 0:this.loadContent(E,C)}loadNewContent(E){const C="plugin"===E,S=C?".plugin.js":".theme.css",x=C?this.pluginsFolder:this.themesFolder,T=l.readdirSync(x),N=Object.values(C?bdplugins:bdthemes),D=N.filter(F=>!T.includes(F.filename)).map(F=>C?F.plugin.getName():F.name),P=T.filter(F=>!N.find(B=>B.filename==F)&&F.endsWith(S)&&l.statSync(o.resolve(x,F)).isFile());return{added:P,removed:D}}loadAllContent(E){const C="plugin"===E,S=C?".plugin.js":".theme.css",x=C?this.pluginsFolder:this.themesFolder,T=[],N=l.readdirSync(x);for(const D of N)if(l.statSync(o.resolve(x,D)).isFile()&&D.endsWith(S)){const te=this.loadContent(D,E);te&&T.push(te)}return T}loadPlugins(){return this.loadAllContent("plugin")}loadThemes(){return this.loadAllContent("theme")}}})(),pluginCookie={};function PluginModule(){}PluginModule.prototype.loadPlugins=function(){this.loadPluginData(),bdpluginErrors=ContentManager.loadPlugins();for(var o=Object.keys(bdplugins),l=0;l<o.length;l++){var d,u;try{d=bdplugins[o[l]].plugin,u=d.getName(),d.load&&"function"==typeof d.load&&d.load()}catch(h){pluginCookie[u]=!1,Utils.err("Plugin "+u+" could not be loaded.",h),bdpluginErrors.push({name:u,file:bdplugins[o[l]].filename,reason:"load() could not be fired.",error:{message:h.message,stack:h.stack}});continue}if(pluginCookie[u]||(pluginCookie[u]=!1),pluginCookie[u])try{d.start(),settingsCookie["fork-ps-2"]&&mainCore.showToast(`${d.getName()} v${d.getVersion()} has started.`)}catch(h){pluginCookie[u]=!1,Utils.err("Plugin "+u+" could not be started.",h),bdpluginErrors.push({name:u,file:bdplugins[o[l]].filename,reason:"start() could not be fired.",error:{message:h.message,stack:h.stack}})}}this.savePluginData(),require("electron").remote.getCurrentWebContents().on("did-navigate-in-page",this.channelSwitch.bind(this))},PluginModule.prototype.startPlugin=function(o,l=!1){try{bdplugins[o].plugin.start(),settingsCookie["fork-ps-2"]&&!l&&mainCore.showToast(`${bdplugins[o].plugin.getName()} v${bdplugins[o].plugin.getVersion()} has started.`)}catch(d){pluginCookie[o]=!1,this.savePluginData(),Utils.err("Plugin "+name+" could not be started.",d)}},PluginModule.prototype.stopPlugin=function(o,l=!1){try{bdplugins[o].plugin.stop(),settingsCookie["fork-ps-2"]&&!l&&mainCore.showToast(`${bdplugins[o].plugin.getName()} v${bdplugins[o].plugin.getVersion()} has stopped.`)}catch(d){Utils.err("Plugin "+name+" could not be stopped.",d)}},PluginModule.prototype.enablePlugin=function(o,l=!1){pluginCookie[o]||(pluginCookie[o]=!0,this.savePluginData(),this.startPlugin(o,l))},PluginModule.prototype.disablePlugin=function(o,l=!1){pluginCookie[o]&&(pluginCookie[o]=!1,this.savePluginData(),this.stopPlugin(o,l))},PluginModule.prototype.togglePlugin=function(o){pluginCookie[o]?this.disablePlugin(o):this.enablePlugin(o)},PluginModule.prototype.loadPlugin=function(o){const l=ContentManager.loadContent(o,"plugin");if(l&&settingsCookie["fork-ps-2"])return Utils.err(`${o} could not be loaded.`,l),BdApi.showToast(`${o} could not be loaded.`,{type:"error"});const d=Object.values(bdplugins).find(u=>u.filename==o).plugin;settingsCookie["fork-ps-2"]&&BdApi.showToast(`${d.getName()} v${d.getVersion()} was loaded.`,{type:"success"})},PluginModule.prototype.unloadPlugin=function(o){pluginCookie[o]&&this.disablePlugin(o,!0);const l=ContentManager.unloadContent(bdplugins[o].filename,"plugin");return delete bdplugins[o],l&&settingsCookie["fork-ps-2"]?(Utils.err(`${o} could not be unloaded. It may have not been loaded yet.`,l),BdApi.showToast(`${o} could not be unloaded. It may have not been loaded yet.`,{type:"error"})):void(settingsCookie["fork-ps-2"]&&BdApi.showToast(`${o} was unloaded.`,{type:"success"}))},PluginModule.prototype.reloadPlugin=function(o){const l=pluginCookie[o];l&&this.stopPlugin(o,!0);const d=ContentManager.reloadContent(bdplugins[o].filename,"plugin");return l&&(bdplugins[o].plugin.load&&"function"==typeof bdplugins[o].plugin.load&&bdplugins[o].plugin.load(),this.startPlugin(o,!0)),d&&settingsCookie["fork-ps-2"]?(Utils.err(`${o} could not be reloaded.`,d),BdApi.showToast(`${o} could not be reloaded.`,{type:"error"})):void(settingsCookie["fork-ps-2"]&&BdApi.showToast(`${o} v${bdplugins[o].plugin.getVersion()} was reloaded.`,{type:"success"}))},PluginModule.prototype.updatePluginList=function(){const o=ContentManager.loadNewContent("plugin");for(const l of o.added)this.loadPlugin(l);for(const l of o.removed)this.unloadPlugin(l)},PluginModule.prototype.loadPluginData=function(){let o=DataStore.getSettingGroup("plugins");o&&(pluginCookie=o)},PluginModule.prototype.savePluginData=function(){DataStore.setSettingGroup("plugins",pluginCookie)},PluginModule.prototype.newMessage=function(){for(var d,o=Object.keys(bdplugins),l=0;l<o.length;l++)if(d=bdplugins[o[l]].plugin,pluginCookie[d.getName()]&&"function"==typeof d.onMessage)try{d.onMessage()}catch(ae){Utils.err("Unable to fire onMessage for "+d.getName()+".",ae)}},PluginModule.prototype.channelSwitch=function(){for(var d,o=Object.keys(bdplugins),l=0;l<o.length;l++)if(d=bdplugins[o[l]].plugin,pluginCookie[d.getName()]&&"function"==typeof d.onSwitch)try{d.onSwitch()}catch(ne){Utils.err("Unable to fire onSwitch for "+d.getName()+".",ne)}},PluginModule.prototype.rawObserver=function(o){for(var u,l=Object.keys(bdplugins),d=0;d<l.length;d++)if(u=bdplugins[l[d]].plugin,pluginCookie[u.getName()]&&"function"==typeof u.observer)try{u.observer(o)}catch(se){Utils.err("Unable to fire observer for "+u.getName()+".",se)}};var themeCookie={};function ThemeModule(){}ThemeModule.prototype.loadThemes=function(){this.loadThemeData(),bdthemeErrors=ContentManager.loadThemes();for(var d,o=Object.keys(bdthemes),l=0;l<o.length;l++)d=bdthemes[o[l]].name,themeCookie[d]||(themeCookie[d]=!1),themeCookie[d]&&$("head").append($("<style>",{id:Utils.escapeID(d),html:unescape(bdthemes[d].css)}));for(let u in themeCookie)bdthemes[u]||delete themeCookie[u];this.saveThemeData()},ThemeModule.prototype.enableTheme=function(o,l=!1){themeCookie[o]=!0,this.saveThemeData(),$("head").append(`<style id="${Utils.escapeID(bdthemes[o].name)}">${unescape(bdthemes[o].css)}</style>`),settingsCookie["fork-ps-2"]&&!l&&mainCore.showToast(`${bdthemes[o].name} v${bdthemes[o].version} has been applied.`)},ThemeModule.prototype.disableTheme=function(o,l=!1){themeCookie[o]=!1,this.saveThemeData(),$(`#${Utils.escapeID(bdthemes[o].name)}`).remove(),settingsCookie["fork-ps-2"]&&!l&&mainCore.showToast(`${bdthemes[o].name} v${bdthemes[o].version} has been disabled.`)},ThemeModule.prototype.toggleTheme=function(o){themeCookie[o]?this.disableTheme(o):this.enableTheme(o)},ThemeModule.prototype.loadTheme=function(o){const l=ContentManager.loadContent(o,"theme");if(l&&settingsCookie["fork-ps-2"])return Utils.err(`${o} could not be loaded.`,l),BdApi.showToast(`${o} could not be loaded. It may not have been loaded.`,{type:"error"});const d=Object.values(bdthemes).find(u=>u.filename==o);settingsCookie["fork-ps-2"]&&BdApi.showToast(`${d.name} v${d.version} was loaded.`,{type:"success"})},ThemeModule.prototype.unloadTheme=function(o){themeCookie[o]&&this.disableTheme(o,!0);const l=ContentManager.unloadContent(bdthemes[o].filename,"theme");return delete bdthemes[o],l&&settingsCookie["fork-ps-2"]?(Utils.err(`${o} could not be unloaded. It may have not been loaded yet.`,l),BdApi.showToast(`${o} could not be unloaded. It may have not been loaded yet.`,{type:"error"})):void(settingsCookie["fork-ps-2"]&&BdApi.showToast(`${o} was unloaded.`,{type:"success"}))},ThemeModule.prototype.reloadTheme=function(o){const l=ContentManager.reloadContent(bdthemes[o].filename,"theme");return themeCookie[o]&&(this.disableTheme(o,!0),this.enableTheme(o,!0)),l&&settingsCookie["fork-ps-2"]?(Utils.err(`${o} could not be reloaded.`,l),BdApi.showToast(`${o} could not be reloaded.`,{type:"error"})):void(settingsCookie["fork-ps-2"]&&BdApi.showToast(`${o} v${bdthemes[o].version} was reloaded.`,{type:"success"}))},ThemeModule.prototype.updateThemeList=function(){const o=ContentManager.loadNewContent("theme");for(const l of o.added)this.loadTheme(l);for(const l of o.removed)this.unloadTheme(l)},ThemeModule.prototype.loadThemeData=function(){let o=DataStore.getSettingGroup("themes");o&&(themeCookie=o)},ThemeModule.prototype.saveThemeData=function(){DataStore.setSettingGroup("themes",themeCookie)};var BdApi={get React(){return BDV2.react},get ReactDOM(){return BDV2.reactDom},get WindowConfigFile(){if(this._windowConfigFile)return this._windowConfigFile;const o=require("electron").remote.app.getAppPath(),l=require("path"),d=l.resolve(o,"..","app","config.json"),u=require("fs");return u.existsSync(d)||u.writeFileSync(d,JSON.stringify({})),this._windowConfigFile=d},getAllWindowPreferences:function(){return require(this.WindowConfigFile)},getWindowPreference:function(o){return this.getAllWindowPreferences()[o]},setWindowPreference:function(o,l){const d=require("fs"),u=this.getAllWindowPreferences();u[o]=l,delete require.original.cache[this.WindowConfigFile],d.writeFileSync(this.WindowConfigFile,JSON.stringify(u,null,4))},injectCSS:function(o,l){$("head").append($("<style>",{id:Utils.escapeID(o),html:l}))},clearCSS:function(o){$("#"+Utils.escapeID(o)).remove()},linkJS:function(o,l){$("head").append($("<script>",{id:Utils.escapeID(o),src:l,type:"text/javascript"}))},unlinkJS:function(o){$("#"+Utils.escapeID(o)).remove()},getPlugin:function(o){return bdplugins.hasOwnProperty(o)?bdplugins[o].plugin:null}},betterDiscordIPC=require("electron").ipcRenderer;BdApi.getIpc=function(){return Utils.warn("[Deprecation Notice] BetterDiscord's IPC has been deprecated and may be removed in future versions."),betterDiscordIPC},BdApi.getCore=function(){return mainCore},BdApi.alert=function(o,l){mainCore.alert(o,l)},BdApi.showToast=function(o,l={}){mainCore.showToast(o,l)},BdApi.findModule=function(o){return BDV2.WebpackModules.find(o)},BdApi.findAllModules=function(o){return BDV2.WebpackModules.findAll(o)},BdApi.findModuleByProps=function(...o){return BDV2.WebpackModules.findByUniqueProperties(o)},BdApi.getInternalInstance=function(o){if(o instanceof window.jQuery||o instanceof Element)return o instanceof jQuery&&(o=o[0]),BDV2.getInternalInstance(o)},BdApi.loadData=function(o,l){return DataStore.getPluginData(o,l)},BdApi.getData=BdApi.loadData,BdApi.saveData=function(o,l,d){return DataStore.setPluginData(o,l,d)},BdApi.setData=BdApi.saveData,BdApi.deleteData=function(o,l){return DataStore.deletePluginData(o,l)},BdApi.monkeyPatch=function(o,l,d){return Utils.monkeyPatch(o,l,d)},BdApi.onRemoved=function(o,l){return Utils.onRemoved(o,l)},BdApi.suppressErrors=function(o,l){return Utils.suppressErrors(o,l)},BdApi.testJSON=function(o){return Utils.testJSON(o)},BdApi.isPluginEnabled=function(o){return!!pluginCookie[o]},BdApi.isThemeEnabled=function(o){return!!themeCookie[o]},BdApi.isSettingEnabled=function(o){return!!settingsCookie[o]},BdApi.getBDData=function(o){return DataStore.getBDData(o)},BdApi.setBDData=function(o,l){return DataStore.setBDData(o,l)};function devMode(){}devMode.prototype.enable=function(o){var l=this;this.disable(),$(window).on("keydown.bdDevmode",function(d){if(119===d.which||118==d.which){console.log("%c[%cDevMode%c] %cBreak/Resume","color: red;","color: #303030; font-weight:700;","color:red;","");debugger}});o&&$(document).on("contextmenu.bdDevmode",function(d){l.lastSelector=l.getSelector(d.toElement),setImmediate(function(){var h=$(".contextMenu-HLZMGh");0>=h.length&&(h=$("<div class=\"contextMenu-HLZMGh bd-context-menu\"></div>"),h.addClass($(".app").hasClass("theme-dark")?"theme-dark":"theme-light"),h.appendTo(".app"),h.css("top",d.clientY),h.css("left",d.clientX),$(document).on("click.bdDevModeCtx",()=>{h.remove(),$(document).off(".bdDevModeCtx")}),$(document).on("contextmenu.bdDevModeCtx",()=>{h.remove(),$(document).off(".bdDevModeCtx")}),$(document).on("keyup.bdDevModeCtx",E=>{27===E.keyCode&&(h.remove(),$(document).off(".bdDevModeCtx"))}));var g=$("<div/>",{"class":"itemGroup-1tL0uz"}),y=$("<div/>",{"class":"item-1Yvehc",click:function(){BDV2.NativeModule.copy(l.lastSelector),h.hide()}}).append($("<span/>",{text:"Copy Selector"}));g.append(y),h.append(g),h.hasClass("undefined")&&h.css("top","-="+g.outerHeight())}),d.stopPropagation()})},devMode.prototype.getRules=function(o,l=o.ownerDocument.styleSheets){return[].concat(...[...l].map(d=>[...(d.cssRules||[])])).filter(d=>d&&d.selectorText&&o.matches(d.selectorText)&&d.style.length&&8>d.selectorText.split(", ").length)},devMode.prototype.getSelector=function(o){if(o.id)return`#${o.id}`;const l=this.getRules(o),d=l[l.length-1];if(d)return d.selectorText;return o.classList.length?`.${Array.from(o.classList).join(".")}`:`.${Array.from(o.parentElement.classList).join(".")}`},devMode.prototype.disable=function(){$(window).off("keydown.bdDevmode"),$(document).off("contextmenu.bdDevmode"),$(document).off("contextmenu.bdDevModeCtx")};var ClassNormalizer=class{constructor(){this.classFormat=/^(?!da-)[A-Za-z]+-([A-Za-z]|[0-9]|-|_){6}$/,this.normFormat=/^(?!da-)(?:-?[a-z])+$/,this.mainObserver=new MutationObserver(l=>{for(let d=0;d<l.length;d++){const u=l[d],h=u.addedNodes;if(h)for(let re=0;re<h.length;re++)h[re]instanceof Element&&h[re].classList&&this.normalizeClasses(h[re])}}),this.cache={},this.isActive=!1}stop(){this.isActive&&(this.isActive=!1,this.mainObserver.disconnect(),this.revertClasses(document.querySelector("#app-mount")))}start(){this.isActive||(this.isActive=!0,this.normalizeClasses(document.querySelector("#app-mount")),this.mainObserver.observe(document.querySelector("#app-mount"),{childList:!0,subtree:!0}))}toCamelCase(l){return l.split("-").map((d,u)=>u?d[0].toUpperCase()+d.slice(1):d).join("")}isRandomizedClass(l){return this.classFormat.test(l)}isNormalClass(l){return this.normFormat.test(l)}normalizeClasses(l){if(l instanceof Element){l.children&&l.children.length&&this.normalizeClasses(l.children[0]),l.nextElementSibling&&this.normalizeClasses(l.nextElementSibling);const d=l.classList,u=[];for(let h=0;h<d.length;h++)if(this.cache[d[h]])u.push(this.cache[d[h]]);else if(this.isNormalClass(d[h])){const g="da-"+this.toCamelCase(d[h]);u.push(g),this.cache[d[h]]=g}else if(this.isRandomizedClass(d[h])){const g="da-"+d[h].split("-")[0];u.push(g),this.cache[d[h]]=g}l.classList.add(...u)}}revertClasses(l){if(l instanceof Element){l.children&&l.children.length&&this.revertClasses(l.children[0]),l.nextElementSibling&&this.revertClasses(l.nextElementSibling);const d=l.classList,u=[];for(let h=0;h<d.length;h++)d[h].startsWith("da-")&&u.push(d[h]);l.classList.remove(...u)}}};class V2{constructor(){this.editorDetached=!1,this.WebpackModules=(()=>{const o=webpackJsonp.push([[],{__extra_id__:(g,y,E)=>g.exports=E},[["__extra_id__"]]]);delete o.m.__extra_id__,delete o.c.__extra_id__;const l=g=>{for(let y in o.c)if(o.c.hasOwnProperty(y)){let E=o.c[y].exports;if(E&&E.__esModule&&E.default&&g(E.default))return E.default;if(E&&g(E))return E}return console.warn("Cannot find loaded module in cache"),null};return{find:l,findAll:g=>{const y=[];for(let E in o.c)if(o.c.hasOwnProperty(E)){let C=o.c[E].exports;C&&C.__esModule&&C.default&&g(C.default)?y.push(C.default):C&&g(C)&&y.push(C)}return y},findByUniqueProperties:g=>l(y=>g.every(E=>y[E]!==void 0)),findByDisplayName:g=>l(y=>y.displayName===g)}})(),this.internal={react:this.WebpackModules.findByUniqueProperties(["Component","PureComponent","Children","createElement","cloneElement"]),reactDom:this.WebpackModules.findByUniqueProperties(["findDOMNode"])},this.getInternalInstance=o=>o[Object.keys(o).find(l=>l.startsWith("__reactInternalInstance"))]}get messageClasses(){return this.WebpackModules.findByUniqueProperties(["message","containerCozy"])||{}}get guildClasses(){return this.WebpackModules.findByUniqueProperties(["guildsWrapper"])||{guildsWrapper:"guilds-wrapper",scrollerWrap:"scroller-wrap",guilds:"guilds",friendsIcon:"friends-icon",homeIcon:"home-icon",guildPlaceholder:"guild-placeholder",guild:"guild",selected:"selected",unread:"unread",guildInner:"guild-inner",audio:"audio",video:"video",guildIcon:"guild-icon",badge:"badge",dms:"dms",guildSeparator:"guild-separator",guildsError:"guilds-error",guildsAdd:"guilds-add",guildsAddInner:"guilds-add-inner",unreadMentionsIndicatorBottom:"unread-mentions-indicator-bottom",unreadMentionsIndicatorTop:"unread-mentions-indicator-top",unreadMentionsBar:"unread-mentions-bar",unreadMentionBar:"unread-mention-bar"}}get MessageContentComponent(){return BDV2.WebpackModules.find(o=>o.defaultProps&&o.defaultProps.hasOwnProperty("disableButtons"))}get TimeFormatter(){return BDV2.WebpackModules.findByUniqueProperties(["dateFormat"])}get TooltipWrapper(){return BDV2.WebpackModules.find(o=>o.prototype&&o.prototype.showDelayed)}get NativeModule(){return BDV2.WebpackModules.findByUniqueProperties(["setBadge"])}get Tooltips(){return BDV2.WebpackModules.find(o=>o.hide&&o.show&&!o.search&&!o.submit&&!o.search&&!o.activateRagingDemon&&!o.dismiss)}get KeyGenerator(){return BDV2.WebpackModules.find(o=>o.toString&&/"binary"/.test(o.toString()))}get reactComponent(){return this.internal.react.Component}get react(){return this.internal.react}get reactDom(){return this.internal.reactDom}parseSettings(o){return Object.keys(settings).reduce((l,d)=>{let u=settings[d];return u.cat===o&&u.implemented&&!u.hidden&&(u.text=d,l.push(u)),l},[])}}var BDV2=new V2;class BDEmote extends BDV2.reactComponent{constructor(o){super(o);const l=quickEmoteMenu&&quickEmoteMenu.favoriteEmotes&&quickEmoteMenu.favoriteEmotes[this.label];this.state={shouldAnimate:!this.animateOnHover,isFavorite:l},this.onMouseEnter=this.onMouseEnter.bind(this),this.onMouseLeave=this.onMouseLeave.bind(this),this.onClick=this.onClick.bind(this)}get animateOnHover(){return settingsCookie["fork-es-2"]}get label(){return this.props.modifier?`${this.props.name}:${this.props.modifier}`:this.props.name}get modifierClass(){return this.props.modifier?` emote${this.props.modifier}`:""}onMouseEnter(){!this.state.shouldAnimate&&this.animateOnHover&&this.setState({shouldAnimate:!0}),!this.state.isFavorite&&quickEmoteMenu.favoriteEmotes[this.label]?this.setState({isFavorite:!0}):this.state.isFavorite&&!quickEmoteMenu.favoriteEmotes[this.label]&&this.setState({isFavorite:!1})}onMouseLeave(){this.state.shouldAnimate&&this.animateOnHover&&this.setState({shouldAnimate:!1})}onClick(o){this.props.onClick&&this.props.onClick(o)}render(){return BDV2.react.createElement(BDV2.TooltipWrapper,{color:"black",position:"top",text:this.label,delay:750},BDV2.react.createElement("div",{className:"emotewrapper"+(this.props.jumboable?" jumboable":""),onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onClick:this.onClick},BDV2.react.createElement("img",{draggable:!1,className:"emote"+this.modifierClass+(this.props.jumboable?" jumboable":"")+(this.state.shouldAnimate?"":" stop-animation"),dataModifier:this.props.modifier,alt:this.label,src:this.props.url}),BDV2.react.createElement("input",{className:"fav"+(this.state.isFavorite?" active":""),title:"Favorite!",type:"button",onClick:o=>{o.preventDefault(),o.stopPropagation(),this.state.isFavorite?(delete quickEmoteMenu.favoriteEmotes[this.label],quickEmoteMenu.updateFavorites()):quickEmoteMenu.favorite(this.label,this.props.url),this.setState({isFavorite:!this.state.isFavorite})}})))}}class V2C_SettingsPanel extends BDV2.reactComponent{constructor(o){super(o)}render(){let{settings:o}=this.props;return BDV2.react.createElement("div",{className:"content-column default"},BDV2.react.createElement(V2Components.SettingsTitle,{text:this.props.title}),this.props.button&&BDV2.react.createElement("button",{key:"title-button",className:"bd-pfbtn",onClick:this.props.button.onClick},this.props.button.title),o.map(l=>{return BDV2.react.createElement(V2Components.Switch,{id:l.id,key:l.id,data:l,checked:settingsCookie[l.id],onChange:(d,u)=>{this.props.onChange(d,u)}})}))}}class V2C_Switch extends BDV2.reactComponent{constructor(o){super(o),this.setInitialState(),this.onChange=this.onChange.bind(this)}setInitialState(){this.state={checked:this.props.checked}}render(){let{text:o,info:l}=this.props.data,{checked:d}=this.state;return BDV2.react.createElement("div",{className:"ui-flex flex-vertical flex-justify-start flex-align-stretch flex-nowrap ui-switch-item"},BDV2.react.createElement("div",{className:"ui-flex flex-horizontal flex-justify-start flex-align-stretch flex-nowrap"},BDV2.react.createElement("h3",{className:"ui-form-title h3 margin-reset margin-reset ui-flex-child"},o),BDV2.react.createElement("label",{className:"ui-switch-wrapper ui-flex-child",style:{flex:"0 0 auto"}},BDV2.react.createElement("input",{className:"ui-switch-checkbox",type:"checkbox",checked:d,onChange:u=>this.onChange(u)}),BDV2.react.createElement("div",{className:`ui-switch ${d?"checked":""}`}))),BDV2.react.createElement("div",{className:"ui-form-text style-description margin-top-4",style:{flex:"1 1 auto"}},l))}onChange(){this.props.onChange(this.props.id,!this.state.checked),this.setState({checked:!this.state.checked})}}class V2C_Scroller extends BDV2.reactComponent{constructor(o){super(o)}render(){let o=`scrollerWrap-2lJEkd scrollerThemed-2oenus themeGhostHairline-DBD-2d${this.props.fade?" scrollerFade-1Ijw5y":""}`,l="scroller-2FKFPG scroller";this.props.sidebar&&(l="scroller-2FKFPG sidebar-region-scroller scroller scroller-2FKFPG"),this.props.contentColumn&&(l="scroller-2FKFPG content-region-scroller scroller scroller-2FKFPG",o="scrollerWrap-2lJEkd content-region-scroller-wrap scrollerThemed-2oenus themeGhost-10fio9 scrollerTrack-3hhmU0 scrollerWrap-2lJEkd content-region-scroller-wrap scrollerThemed-2oenus themeGhost-28MSn0 scrollerTrack-1ZIpsv");let{children:d}=this.props;return BDV2.react.createElement("div",{key:"scrollerwrap",className:o},BDV2.react.createElement("div",{key:"scroller",ref:"scroller",className:l},d))}}class V2C_TabBarItem extends BDV2.reactComponent{constructor(o){super(o),this.setInitialState(),this.onClick=this.onClick.bind(this)}setInitialState(){this.state={selected:this.props.selected||!1}}render(){return BDV2.react.createElement("div",{className:`ui-tab-bar-item${this.props.selected?" selected":""}`,onClick:this.onClick},this.props.text)}onClick(){this.props.onClick&&this.props.onClick(this.props.id)}}class V2C_TabBarSeparator extends BDV2.reactComponent{constructor(o){super(o)}render(){return BDV2.react.createElement("div",{className:"ui-tab-bar-separator margin-top-8 margin-bottom-8"})}}class V2C_TabBarHeader extends BDV2.reactComponent{constructor(o){super(o)}render(){return BDV2.react.createElement("div",{className:"ui-tab-bar-header"},this.props.text)}}class V2C_SideBar extends BDV2.reactComponent{constructor(o){super(o);let l=this;const d=$("[class*=side] > [class*=selected]");d.length&&(l.scn=d.attr("class"));const u=$("[class*=side] > [class*=notSelected]");u.length&&(l.nscn=u.attr("class")),$("[class*='side-'] > [class*='item-']").on("click",()=>{l.setState({selected:null})}),l.setInitialState(),l.onClick=l.onClick.bind(l)}setInitialState(){let o=this;o.state={selected:null,items:o.props.items};let l=o.props.items.find(d=>{return d.selected});l&&(o.state.selected=l.id)}render(){let o=this,{headerText:l}=o.props,{items:d,selected:u}=o.state;return BDV2.react.createElement("div",null,BDV2.react.createElement(V2Components.TabBar.Separator,null),BDV2.react.createElement(V2Components.TabBar.Header,{text:l}),d.map(h=>{let{id:g,text:y}=h;return BDV2.react.createElement(V2Components.TabBar.Item,{key:g,selected:u===g,text:y,id:g,onClick:o.onClick})}))}onClick(o){let l=this;const d=$("[class*=side] > [class*=selected]");d.length&&(d.off("click.bdsb").on("click.bsb",u=>{$(u.target).attr("class",l.scn)}),d.attr("class",l.nscn)),l.setState({selected:null}),l.setState({selected:o}),l.props.onClick&&l.props.onClick(o)}}class V2C_ReloadIcon extends BDV2.reactComponent{constructor(o){super(o)}render(){return BDV2.react.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"#dcddde",className:"bd-reload "+this.props.className,onClick:this.props.onClick,style:{width:this.props.size||"24px",height:this.props.size||"24px"}},BDV2.react.createElement("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"}),BDV2.react.createElement("path",{fill:"none",d:"M0 0h24v24H0z"}))}}class V2C_XSvg extends BDV2.reactComponent{constructor(o){super(o)}render(){return BDV2.react.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 12 12",style:{width:"18px",height:"18px"}},BDV2.react.createElement("g",{className:"background",fill:"none",fillRule:"evenodd"},BDV2.react.createElement("path",{d:"M0 0h12v12H0"}),BDV2.react.createElement("path",{className:"fill",fill:"#dcddde",d:"M9.5 3.205L8.795 2.5 6 5.295 3.205 2.5l-.705.705L5.295 6 2.5 8.795l.705.705L6 6.705 8.795 9.5l.705-.705L6.705 6"})))}}class V2C_Tools extends BDV2.reactComponent{constructor(o){super(o),this.onClick=this.onClick.bind(this)}render(){return BDV2.react.createElement("div",{className:"tools-container"},BDV2.react.createElement("div",{className:"tools"},BDV2.react.createElement("div",{className:"btn-close closeButton-1tv5uR",onClick:this.onClick},BDV2.react.createElement(V2Components.XSvg,null)),BDV2.react.createElement("div",{className:"esc-text keybind-KpFkfr"},"ESC")))}onClick(){this.props.onClick&&this.props.onClick(),$(".closeButton-1tv5uR").first().click()}}class V2C_SettingsTitle extends BDV2.reactComponent{constructor(o){super(o)}render(){return BDV2.react.createElement("h2",{className:"ui-form-title h2 margin-reset margin-bottom-20"},this.props.text)}}class V2C_Checkbox extends BDV2.reactComponent{constructor(o){super(o),this.onClick=this.onClick.bind(this),this.setInitialState()}setInitialState(){this.state={checked:this.props.checked||!1}}render(){return BDV2.react.createElement("li",null,BDV2.react.createElement("div",{className:"checkbox",onClick:this.onClick},BDV2.react.createElement("div",{className:"checkbox-inner"},BDV2.react.createElement("input",{checked:this.state.checked,onChange:()=>{},type:"checkbox"}),BDV2.react.createElement("span",null)),BDV2.react.createElement("span",null,this.props.text)))}onClick(){this.props.onChange(this.props.id,!this.state.checked),this.setState({checked:!this.state.checked})}}class V2C_CssEditorDetached extends BDV2.reactComponent{constructor(o){super(o);let l=this;l.onClick=l.onClick.bind(l),l.updateCss=l.updateCss.bind(l),l.saveCss=l.saveCss.bind(l),l.onChange=l.onChange.bind(l)}componentDidMount(){$("#app-mount").addClass("bd-detached-editor"),BDV2.editorDetached=!0,this.editor=ace.edit("bd-customcss-editor-detached"),this.editor.setTheme("ace/theme/monokai"),this.editor.session.setMode("ace/mode/css"),this.editor.setShowPrintMargin(!1),this.editor.setFontSize(14),this.editor.on("change",()=>{settingsCookie["bda-css-0"]&&(this.saveCss(),this.updateCss())})}componentWillUnmount(){$("#app-mount").removeClass("bd-detached-editor"),BDV2.editorDetached=!1,this.editor.destroy()}updateLineCount(){let o=this.refs.editor.value.split("\n").length;o==this.props.lines||(this.refs.lines.textContent=Array.from(Array(o),(l,d)=>d+1).join(".\n")+".",this.props.lines=o)}get options(){return{lineNumbers:!0,mode:"css",indentUnit:4,theme:"material",scrollbarStyle:"simple"}}get css(){let o=DataStore.getBDData("bdcustomcss"),l="";return o&&""!==o&&(l=atob(o)),l}get root(){let o=$("#bd-customcss-detach-container");return o.length?o[0]:this.injectRoot()?this.detachedRoot:null}injectRoot(){return!!$(".app").length&&($("<div/>",{id:"bd-customcss-detach-container"}).insertAfter($(".app")),!0)}render(){let o=this;return BDV2.react.createElement("div",{className:"bd-detached-css-editor",id:"bd-customcss-detach-editor"},BDV2.react.createElement("div",{id:"bd-customcss-innerpane"},BDV2.react.createElement("div",{className:"editor-wrapper"},BDV2.react.createElement("div",{id:"bd-customcss-editor-detached",className:"editor",ref:"editor"},o.css)),BDV2.react.createElement("div",{id:"bd-customcss-attach-controls"},BDV2.react.createElement("ul",{className:"checkbox-group"},BDV2.react.createElement(V2Components.Checkbox,{id:"live-update",text:"Live Update",onChange:o.onChange,checked:settingsCookie["bda-css-0"]})),BDV2.react.createElement("div",{id:"bd-customcss-detach-controls-button"},BDV2.react.createElement("button",{style:{borderRadius:"3px 0 0 3px",borderRight:"1px solid #3f4146"},className:"btn btn-primary",onClick:()=>{o.onClick("update")}},"Update"),BDV2.react.createElement("button",{style:{borderRadius:"0",borderLeft:"1px solid #2d2d2d",borderRight:"1px solid #2d2d2d"},className:"btn btn-primary",onClick:()=>{o.onClick("save")}},"Save"),BDV2.react.createElement("button",{style:{borderRadius:"0 3px 3px 0",borderLeft:"1px solid #3f4146"},className:"btn btn-primary",onClick:()=>{o.onClick("attach")}},"Attach"),BDV2.react.createElement("span",{style:{fontSize:"10px",marginLeft:"5px"}},"Unsaved changes are lost on attach")))))}onChange(o,l){"live-update"===o?(settingsCookie["bda-css-0"]=l,mainCore.saveSettings()):void 0}onClick(o){let l=this;"attach"===o?($("#editor-detached").length&&l.props.attach(),BDV2.reactDom.unmountComponentAtNode(l.root),l.root.remove()):"update"===o?l.updateCss():"save"===o?l.saveCss():void 0}updateCss(){0==$("#customcss").length&&$("head").append("<style id=\"customcss\"></style>"),$("#customcss").html(this.editor.session.getValue()).detach().appendTo(document.head)}saveCss(){DataStore.setBDData("bdcustomcss",btoa(this.editor.session.getValue()))}}class V2C_CssEditor extends BDV2.reactComponent{constructor(o){super(o);let l=this;l.props.lines=0,l.setInitialState(),l.attach=l.attach.bind(l),l.detachedEditor=BDV2.react.createElement(V2C_CssEditorDetached,{attach:l.attach}),l.onClick=l.onClick.bind(l),l.updateCss=l.updateCss.bind(l),l.saveCss=l.saveCss.bind(l),l.detach=l.detach.bind(l)}setInitialState(){this.state={detached:this.props.detached||BDV2.editorDetached}}componentDidMount(){this.editor=ace.edit("bd-customcss-editor"),this.editor.setTheme("ace/theme/monokai"),this.editor.session.setMode("ace/mode/css"),this.editor.setShowPrintMargin(!1),this.editor.setFontSize(14),this.editor.on("change",()=>{settingsCookie["bda-css-0"]&&(this.saveCss(),this.updateCss())})}componentWillUnmount(){this.editor.destroy()}componentDidUpdate(o,l){let d=this;l.detached&&!d.state.detached&&BDV2.reactDom.unmountComponentAtNode(d.detachedRoot)}codeMirror(){}get options(){return{lineNumbers:!0,mode:"css",indentUnit:4,theme:"material",scrollbarStyle:"simple"}}get css(){let o=DataStore.getBDData("bdcustomcss"),l="";return o&&""!==o&&(l=atob(o)),l}updateLineCount(){let o=this.refs.editor.value.split("\n").length;o==this.props.lines||(this.refs.lines.textContent=Array.from(Array(o),(l,d)=>d+1).join(".\n")+".",this.props.lines=o)}render(){let o=this,{detached:l}=o.state;return BDV2.react.createElement("div",{className:"content-column default",style:{padding:"60px 40px 0px"}},l&&BDV2.react.createElement("div",{id:"editor-detached"},BDV2.react.createElement(V2Components.SettingsTitle,{text:"Custom CSS Editor"}),BDV2.react.createElement("h3",null,"Editor Detached"),BDV2.react.createElement("button",{className:"btn btn-primary",onClick:()=>{o.attach()}},"Attach")),!l&&BDV2.react.createElement("div",null,BDV2.react.createElement(V2Components.SettingsTitle,{text:"Custom CSS Editor"}),BDV2.react.createElement("div",{className:"editor-wrapper"},BDV2.react.createElement("div",{id:"bd-customcss-editor",className:"editor",ref:"editor"},o.css)),BDV2.react.createElement("div",{id:"bd-customcss-attach-controls"},BDV2.react.createElement("ul",{className:"checkbox-group"},BDV2.react.createElement(V2Components.Checkbox,{id:"live-update",text:"Live Update",onChange:this.onChange,checked:settingsCookie["bda-css-0"]})),BDV2.react.createElement("div",{id:"bd-customcss-detach-controls-button"},BDV2.react.createElement("button",{style:{borderRadius:"3px 0 0 3px",borderRight:"1px solid #3f4146"},className:"btn btn-primary",onClick:()=>{o.onClick("update")}},"Update"),BDV2.react.createElement("button",{style:{borderRadius:"0",borderLeft:"1px solid #2d2d2d",borderRight:"1px solid #2d2d2d"},className:"btn btn-primary",onClick:()=>{o.onClick("save")}},"Save"),BDV2.react.createElement("button",{style:{borderRadius:"0 3px 3px 0",borderLeft:"1px solid #3f4146"},className:"btn btn-primary",onClick:()=>{o.onClick("detach")}},"Detach"),BDV2.react.createElement("span",{style:{fontSize:"10px",marginLeft:"5px"}},"Unsaved changes are lost on detach")))))}onClick(o){let l=this;"update"===o?l.updateCss():"save"===o?l.saveCss():"detach"===o?l.detach():void 0}onChange(o,l){"live-update"===o?(settingsCookie["bda-css-0"]=l,mainCore.saveSettings()):void 0}updateCss(){0==$("#customcss").length&&$("head").append("<style id=\"customcss\"></style>"),$("#customcss").html(this.editor.session.getValue()).detach().appendTo(document.head)}saveCss(){DataStore.setBDData("bdcustomcss",btoa(this.editor.session.getValue()))}detach(){let o=this;o.setState({detached:!0});let l=o.detachedRoot;return l?void BDV2.reactDom.render(o.detachedEditor,l):void console.log("FAILED TO INJECT ROOT: .app")}get detachedRoot(){let o=$("#bd-customcss-detach-container");return o.length?o[0]:this.injectDetachedRoot()?this.detachedRoot:null}injectDetachedRoot(){return!!$(".app").length&&($("<div/>",{id:"bd-customcss-detach-container"}).insertAfter($(".app")),!0)}attach(){let o=this;o.setState({detached:!1})}}class V2C_List extends BDV2.reactComponent{constructor(o){super(o)}render(){return BDV2.react.createElement("ul",{className:this.props.className},this.props.children)}}class V2C_ContentColumn extends BDV2.reactComponent{constructor(o){super(o)}render(){return BDV2.react.createElement("div",{className:"content-column default"},BDV2.react.createElement("h2",{className:"ui-form-title h2 margin-reset margin-bottom-20"},this.props.title),this.props.children)}}class V2C_PluginCard extends BDV2.reactComponent{constructor(o){super(o);let l=this;l.onChange=l.onChange.bind(l),l.showSettings=l.showSettings.bind(l),l.setInitialState(),l.hasSettings="function"==typeof l.props.plugin.getSettingsPanel,l.settingsPanel="",this.reload=this.reload.bind(this)}setInitialState(){this.state={checked:pluginCookie[this.props.plugin.getName()],settings:!1,reloads:0}}componentDidUpdate(){if(this.state.settings){if("object"==typeof this.settingsPanel&&this.refs.settingspanel.appendChild(this.settingsPanel),!settingsCookie["fork-ps-3"])return;var o=(u,h)=>{let g=u.scrollTop,y=g+u.clientHeight,E=h.offsetTop,C=E+h.clientHeight;return E<g||C>y};let l=$(BDV2.reactDom.findDOMNode(this)),d=l.parents(".scroller");if(!o(d[0],l[0]))return;d.animate({scrollTop:l.offset().top-d.offset().top+d.scrollTop()-30},300)}}reload(){const o=this.props.plugin.getName();pluginModule.reloadPlugin(o),this.props.plugin=bdplugins[o].plugin,this.setState({reloads:this.state.reloads+1})}render(){let o=this,{plugin:l}=this.props,d=l.getName(),u=l.getAuthor(),h=l.getDescription(),g=l.getVersion(),y=bdplugins[d].website,E=bdplugins[d].source;if(this.state.settings){try{o.settingsPanel=l.getSettingsPanel()}catch(C){Utils.err("Unable to get settings panel for "+l.getName()+".",C)}return BDV2.react.createElement("li",{className:"settings-open ui-switch-item"},BDV2.react.createElement("div",{style:{float:"right",cursor:"pointer"},onClick:()=>{this.refs.settingspanel.innerHTML="",o.setState({settings:!1})}},BDV2.react.createElement(V2Components.XSvg,null)),"object"==typeof o.settingsPanel&&BDV2.react.createElement("div",{id:`plugin-settings-${d}`,className:"plugin-settings",ref:"settingspanel"}),"object"!=typeof o.settingsPanel&&BDV2.react.createElement("div",{id:`plugin-settings-${d}`,className:"plugin-settings",ref:"settingspanel",dangerouslySetInnerHTML:{__html:o.settingsPanel}}))}return BDV2.react.createElement("li",{"data-name":d,"data-version":g,className:"settings-closed ui-switch-item"},BDV2.react.createElement("div",{className:"bda-header"},BDV2.react.createElement("span",{className:"bda-header-title"},BDV2.react.createElement("span",{className:"bda-name"},d)," v",BDV2.react.createElement("span",{className:"bda-version"},g)," by ",BDV2.react.createElement("span",{className:"bda-author"},u)),BDV2.react.createElement("div",{className:"bda-controls"},!settingsCookie["fork-ps-5"]&&BDV2.react.createElement(V2Components.TooltipWrap(V2Components.ReloadIcon,{color:"black",side:"top",text:"Reload"}),{className:"bd-reload-card",onClick:this.reload}),BDV2.react.createElement("label",{className:"ui-switch-wrapper ui-flex-child",style:{flex:"0 0 auto"}},BDV2.react.createElement("input",{checked:this.state.checked,onChange:this.onChange,className:"ui-switch-checkbox",type:"checkbox"}),BDV2.react.createElement("div",{className:this.state.checked?"ui-switch checked":"ui-switch"})))),BDV2.react.createElement("div",{className:"bda-description-wrap scroller-wrap fade"},BDV2.react.createElement("div",{className:"bda-description scroller"},h)),(y||E||this.hasSettings)&&BDV2.react.createElement("div",{className:"bda-footer"},BDV2.react.createElement("span",{className:"bda-links"},y&&BDV2.react.createElement("a",{className:"bda-link bda-link-website",href:y,target:"_blank"},"Website"),y&&E&&" | ",E&&BDV2.react.createElement("a",{className:"bda-link bda-link-source",href:E,target:"_blank"},"Source")),this.hasSettings&&BDV2.react.createElement("button",{onClick:this.showSettings,className:"bda-settings-button",disabled:!this.state.checked},"Settings")))}onChange(){this.setState({checked:!this.state.checked}),pluginModule.togglePlugin(this.props.plugin.getName())}showSettings(){this.hasSettings&&this.setState({settings:!0})}}class V2C_ThemeCard extends BDV2.reactComponent{constructor(o){super(o),this.setInitialState(),this.onChange=this.onChange.bind(this),this.reload=this.reload.bind(this)}setInitialState(){this.state={checked:themeCookie[this.props.theme.name],reloads:0}}reload(){const o=this.props.theme.name,l=themeModule.reloadTheme(o);l?mainCore.showToast(`Could not reload ${bdthemes[o].name}. Check console for details.`,{type:"error"}):mainCore.showToast(`${bdthemes[o].name} v${bdthemes[o].version} has been reloaded.`,{type:"success"}),this.props.theme=bdthemes[o],this.setState({reloads:this.state.reloads+1})}render(){let{theme:o}=this.props,l=o.name,d=o.description,u=o.version,h=o.author,g=bdthemes[l].website,y=bdthemes[l].source;return BDV2.react.createElement("li",{"data-name":l,"data-version":u,className:"settings-closed ui-switch-item"},BDV2.react.createElement("div",{className:"bda-header"},BDV2.react.createElement("span",{className:"bda-header-title"},BDV2.react.createElement("span",{className:"bda-name"},l)," v",BDV2.react.createElement("span",{className:"bda-version"},u)," by ",BDV2.react.createElement("span",{className:"bda-author"},h)),BDV2.react.createElement("div",{className:"bda-controls"},!settingsCookie["fork-ps-5"]&&BDV2.react.createElement(V2Components.TooltipWrap(V2Components.ReloadIcon,{color:"black",side:"top",text:"Reload"}),{className:"bd-reload-card",onClick:this.reload}),BDV2.react.createElement("label",{className:"ui-switch-wrapper ui-flex-child",style:{flex:"0 0 auto"}},BDV2.react.createElement("input",{checked:this.state.checked,onChange:this.onChange,className:"ui-switch-checkbox",type:"checkbox"}),BDV2.react.createElement("div",{className:this.state.checked?"ui-switch checked":"ui-switch"})))),BDV2.react.createElement("div",{className:"bda-description-wrap scroller-wrap fade"},BDV2.react.createElement("div",{className:"bda-description scroller"},d)),(g||y)&&BDV2.react.createElement("div",{className:"bda-footer"},BDV2.react.createElement("span",{className:"bda-links"},g&&BDV2.react.createElement("a",{className:"bda-link",href:g,target:"_blank"},"Website"),g&&y&&" | ",y&&BDV2.react.createElement("a",{className:"bda-link",href:y,target:"_blank"},"Source"))))}onChange(){this.setState({checked:!this.state.checked}),themeModule.toggleTheme(this.props.theme.name)}}class V2Cs_TabBar{static get Item(){return V2C_TabBarItem}static get Header(){return V2C_TabBarHeader}static get Separator(){return V2C_TabBarSeparator}}class V2Components{static get SettingsPanel(){return V2C_SettingsPanel}static get Switch(){return V2C_Switch}static get Scroller(){return V2C_Scroller}static get TabBar(){return V2Cs_TabBar}static get SideBar(){return V2C_SideBar}static get Tools(){return V2C_Tools}static get SettingsTitle(){return V2C_SettingsTitle}static get CssEditor(){return V2C_CssEditor}static get Checkbox(){return V2C_Checkbox}static get List(){return V2C_List}static get PluginCard(){return V2C_PluginCard}static get ThemeCard(){return V2C_ThemeCard}static get ContentColumn(){return V2C_ContentColumn}static get ReloadIcon(){return V2C_ReloadIcon}static get XSvg(){return V2C_XSvg}static get Layer(){return V2C_Layer}static get SidebarView(){return V2C_SidebarView}static get ServerCard(){return V2C_ServerCard}static TooltipWrap(o,l){const{style:d="black",side:u="top",text:h=""}=l,g=BDV2.KeyGenerator();return class extends BDV2.reactComponent{constructor(y){super(y),this.onMouseEnter=this.onMouseEnter.bind(this),this.onMouseLeave=this.onMouseLeave.bind(this)}componentDidMount(){this.node=BDV2.reactDom.findDOMNode(this),this.node.addEventListener("mouseenter",this.onMouseEnter),this.node.addEventListener("mouseleave",this.onMouseLeave)}componentWillUnmount(){this.node.removeEventListener("mouseenter",this.onMouseEnter),this.node.removeEventListener("mouseleave",this.onMouseLeave)}onMouseEnter(){const{left:y,top:E,width:C,height:S}=this.node.getBoundingClientRect();BDV2.Tooltips.show(g,{position:u,text:h,color:d,targetWidth:C,targetHeight:S,windowWidth:Utils.screenWidth,windowHeight:Utils.screenHeight,x:y,y:E});const x=new MutationObserver(T=>{T.forEach(N=>{const D=Array.from(N.removedNodes),P=-1<D.indexOf(this.node),F=D.some(B=>B.contains(this.node));(P||F)&&(this.onMouseLeave(),x.disconnect())})});x.observe(document.body,{subtree:!0,childList:!0})}onMouseLeave(){BDV2.Tooltips.hide(g)}render(){return BDV2.react.createElement(o,this.props)}}}}class V2_SettingsPanel_Sidebar{constructor(o){this.onClick=o}get items(){return[{text:"Core",id:"core"},{text:"Zere's Fork",id:"fork"},{text:"Emotes",id:"emotes"},{text:"Custom CSS",id:"customcss"},{text:"Plugins",id:"plugins"},{text:"Themes",id:"themes"}]}get component(){return BDV2.react.createElement("span",null,BDV2.react.createElement(V2Components.SideBar,{onClick:this.onClick,headerText:"Bandaged BD",items:this.items}),BDV2.react.createElement("div",{style:{fontSize:"12px",fontWeight:"600",color:"#72767d",padding:"2px 10px"}},`BD v${bdConfig.version} by `,BDV2.react.createElement("a",{href:"https://github.com/Jiiks/",target:"_blank"},"Jiiks")),BDV2.react.createElement("div",{style:{fontSize:"12px",fontWeight:"600",color:"#72767d",padding:"2px 10px"}},`BBD v${bbdVersion} by `,BDV2.react.createElement("a",{href:"https://github.com/rauenzi/",target:"_blank"},"Zerebos")))}get root(){let o=$("#bd-settings-sidebar");return o.length?o[0]:this.injectRoot()?this.root:null}injectRoot(){let o=$("[class*='side-'] > [class*='item-']:not([class*=Danger])").last();return!!o.length&&($("<span/>",{id:"bd-settings-sidebar"}).insertBefore(o.prev()),!0)}render(){let o=this.root;return o?void(BDV2.reactDom.render(this.component,o),Utils.onRemoved(o,()=>{BDV2.reactDom.unmountComponentAtNode(o)})):void console.log("FAILED TO LOCATE ROOT: [class*='side-'] > [class*='item-']:not([class*=Danger])")}}class V2_SettingsPanel{constructor(){let o=this;o.sideBarOnClick=o.sideBarOnClick.bind(o),o.onChange=o.onChange.bind(o),o.updateSettings=this.updateSettings.bind(o),o.sidebar=new V2_SettingsPanel_Sidebar(o.sideBarOnClick)}get root(){let o=$("#bd-settingspane-container");return o.length?o[0]:this.injectRoot()?this.root:null}injectRoot(){if(!$(".layer-3QrUeG .ui-standard-sidebar-view, .layer-3QrUeG .ui-standard-sidebar-view").length)return!1;const o=$("<div/>",{"class":"content-region",id:"bd-settingspane-container"});return $(".layer-3QrUeG .ui-standard-sidebar-view, .layer-3QrUeG .ui-standard-sidebar-view").append(o),Utils.onRemoved(o[0],()=>{BDV2.reactDom.unmountComponentAtNode(o[0])}),!0}get coreSettings(){return this.getSettings("core")}get forkSettings(){return this.getSettings("fork")}get emoteSettings(){return this.getSettings("emote")}getSettings(o){return Object.keys(settings).reduce((l,d)=>{let u=settings[d];return u.cat===o&&u.implemented&&!u.hidden&&(u.text=d,l.push(u)),l},[])}sideBarOnClick(o){let l=this;$(".content-region").first().hide(),$(l.root).show();"core"===o?l.renderCoreSettings():"fork"===o?l.renderForkSettings():"emotes"===o?l.renderEmoteSettings():"customcss"===o?l.renderCustomCssEditor():"plugins"===o?l.renderPluginPane():"themes"===o?l.renderThemePane():void 0}onClick(){}onChange(o,l){settingsCookie[o]=l,this.updateSettings()}updateSettings(){let o=settingsCookie;if(o["bda-es-0"]?$("#twitchcord-button-container").show():$("#twitchcord-button-container").hide(),o["bda-gs-b"]?$("body").addClass("bd-blue"):$("body").removeClass("bd-blue"),o["bda-gs-2"]?$("body").addClass("bd-minimal"):$("body").removeClass("bd-minimal"),o["bda-gs-3"]?$("body").addClass("bd-minimal-chan"):$("body").removeClass("bd-minimal-chan"),o["bda-gs-1"]?$("#bd-pub-li").show():$("#bd-pub-li").hide(),o["bda-gs-4"]?voiceMode.enable():voiceMode.disable(),o["bda-gs-5"]?$("#app-mount").addClass("bda-dark"):$("#app-mount").removeClass("bda-dark"),o["bda-gs-6"]&&mainCore.inject24Hour(),o["bda-gs-7"]?mainCore.injectColoredText():mainCore.removeColoredText(),o["fork-ps-4"]?classNormalizer.start():classNormalizer.stop(),o["fork-ps-5"]?(ContentManager.watchContent("plugin"),ContentManager.watchContent("theme")):(ContentManager.unwatchContent("plugin"),ContentManager.unwatchContent("theme")),o["fork-wp-1"]){const l=BdApi.getWindowPreference("transparent");l!=o["fork-wp-1"]&&BdApi.setWindowPreference("transparent",o["fork-wp-1"])}if(o["fork-wp-2"]){const l=BdApi.getWindowPreference("frame");l!=o["fork-wp-2"]&&BdApi.setWindowPreference("frame",o["fork-wp-2"])}o["bda-gs-8"]?dMode.enable(o["fork-dm-1"]):dMode.disable(),mainCore.saveSettings()}renderSidebar(){let o=this;$("[class*='side-'] > [class*='item-']").off("click.v2settingspanel").on("click.v2settingspanel",()=>{BDV2.reactDom.unmountComponentAtNode(o.root),$(o.root).hide(),$(".content-region").first().show()}),o.sidebar.render()}get coreComponent(){return BDV2.react.createElement(V2Components.Scroller,{contentColumn:!0,fade:!0,dark:!0,children:[BDV2.react.createElement(V2Components.SettingsPanel,{key:"cspanel",title:"Core Settings",onChange:this.onChange,settings:this.coreSettings}),BDV2.react.createElement(V2Components.Tools,{key:"tools"})]})}get forkComponent(){return BDV2.react.createElement(V2Components.Scroller,{contentColumn:!0,fade:!0,dark:!0,children:[BDV2.react.createElement(V2Components.SettingsPanel,{key:"fspanel",title:"Zere's Fork Settings",onChange:this.onChange,settings:this.forkSettings,button:{title:"Clear Emote Cache",onClick:()=>{emoteModule.clearEmoteData(),emoteModule.init(),quickEmoteMenu.init()}}}),BDV2.react.createElement(V2Components.Tools,{key:"tools"})]})}get emoteComponent(){return BDV2.react.createElement(V2Components.Scroller,{contentColumn:!0,fade:!0,dark:!0,children:[BDV2.react.createElement(V2Components.SettingsPanel,{key:"espanel",title:"Emote Settings",onChange:this.onChange,settings:this.emoteSettings}),BDV2.react.createElement(V2Components.Tools,{key:"tools"})]})}get customCssComponent(){return BDV2.react.createElement(V2Components.Scroller,{contentColumn:!0,fade:!0,dark:!0,children:[BDV2.react.createElement(V2Components.CssEditor,{key:"csseditor"}),BDV2.react.createElement(V2Components.Tools,{key:"tools"})]})}get pluginsComponent(){let o=Object.keys(bdplugins).sort((g,y)=>g.toLowerCase().localeCompare(y.toLowerCase())).reduce((g,y)=>{return g.push(BDV2.react.createElement(V2Components.PluginCard,{key:y,plugin:bdplugins[y].plugin})),g},[]),l=BDV2.react.createElement(V2Components.List,{key:"plugin-list",className:"bda-slist",children:o}),d=!settingsCookie["fork-ps-5"]&&BDV2.react.createElement(V2Components.TooltipWrap(V2Components.ReloadIcon,{color:"black",side:"top",text:"Reload Plugin List"}),{className:"bd-reload-header",size:"18px",onClick:async()=>{pluginModule.updatePluginList(),this.sideBarOnClick("plugins")}}),u=BDV2.react.createElement("button",{key:"folder-button",className:"bd-pfbtn",onClick:()=>{require("electron").shell.openItem(ContentManager.pluginsFolder)}},"Open Plugin Folder"),h=BDV2.react.createElement(V2Components.ContentColumn,{key:"pcolumn",title:"Plugins",children:[d,u,l]});return BDV2.react.createElement(V2Components.Scroller,{contentColumn:!0,fade:!0,dark:!0,children:[h,BDV2.react.createElement(V2Components.Tools,{key:"tools"})]})}get themesComponent(){let o=Object.keys(bdthemes).sort((g,y)=>g.toLowerCase().localeCompare(y.toLowerCase())).reduce((g,y)=>{return g.push(BDV2.react.createElement(V2Components.ThemeCard,{key:y,theme:bdthemes[y]})),g},[]),l=BDV2.react.createElement(V2Components.List,{key:"theme-list",className:"bda-slist",children:o}),d=!settingsCookie["fork-ps-5"]&&BDV2.react.createElement(V2Components.TooltipWrap(V2Components.ReloadIcon,{color:"black",side:"top",text:"Reload Theme List"}),{className:"bd-reload-header",size:"18px",onClick:async()=>{themeModule.updateThemeList(),this.sideBarOnClick("themes")}}),u=BDV2.react.createElement("button",{key:"folder-button",className:"bd-pfbtn",onClick:()=>{require("electron").shell.openItem(ContentManager.themesFolder)}},"Open Theme Folder"),h=BDV2.react.createElement(V2Components.ContentColumn,{key:"tcolumn",title:"Themes",children:[d,u,l]});return BDV2.react.createElement(V2Components.Scroller,{contentColumn:!0,fade:!0,dark:!0,children:[h,BDV2.react.createElement(V2Components.Tools,{key:"tools"})]})}renderCoreSettings(){let o=this.root;return o?void BDV2.reactDom.render(this.coreComponent,o):void console.log("FAILED TO LOCATE ROOT: .layer .ui-standard-sidebar-view")}renderForkSettings(){let o=this.root;return o?void BDV2.reactDom.render(this.forkComponent,o):void console.log("FAILED TO LOCATE ROOT: .layer .ui-standard-sidebar-view")}renderEmoteSettings(){let o=this.root;return o?void BDV2.reactDom.render(this.emoteComponent,o):void console.log("FAILED TO LOCATE ROOT: .layer .ui-standard-sidebar-view")}renderCustomCssEditor(){let o=this.root;return o?void BDV2.reactDom.render(this.customCssComponent,o):void console.log("FAILED TO LOCATE ROOT: .layer .ui-standard-sidebar-view")}renderPluginPane(){let o=this.root;return o?void BDV2.reactDom.render(this.pluginsComponent,o):void console.log("FAILED TO LOCATE ROOT: .layer .ui-standard-sidebar-view")}renderThemePane(){let o=this.root;return o?void BDV2.reactDom.render(this.themesComponent,o):void console.log("FAILED TO LOCATE ROOT: .layer .ui-standard-sidebar-view")}}class V2C_Layer extends BDV2.reactComponent{constructor(o){super(o)}componentDidMount(){$(window).on(`keyup.${this.props.id}`,o=>{27===o.which&&BDV2.reactDom.unmountComponentAtNode(this.refs.root.parentNode)}),$(`#${this.props.id}`).animate({opacity:1},{step:function(o){$(this).css("transform",`scale(${1.1-0.1*o}) translateZ(0px)`)},duration:200,done:()=>{$(`#${this.props.id}`).css("opacity","").css("transform","")}})}componentWillUnmount(){$(window).off(`keyup.${this.props.id}`),$(`#${this.props.id}`).animate({opacity:0},{step:function(o){$(this).css("transform",`scale(${1.1-0.1*o}) translateZ(0px)`)},duration:200,done:()=>{$(`#${this.props.rootId}`).remove()}}),$("[class*=\"layer-\"]").removeClass("publicServersOpen").animate({opacity:1},{step:function(o){$(this).css("transform",`scale(${0.07*o+0.93}) translateZ(0px)`)},duration:200,done:()=>{$("[class*=\"layer-\"]").css("opacity","").css("transform","")}})}componentWillMount(){$("[class*=\"layer-\"]").addClass("publicServersOpen").animate({opacity:0},{step:function(o){$(this).css("transform",`scale(${0.07*o+0.93}) translateZ(0px)`)},duration:200})}render(){return BDV2.react.createElement("div",{className:"layer bd-layer layer-3QrUeG",id:this.props.id,ref:"root",style:{opacity:0,transform:"scale(1.1) translateZ(0px)"}},this.props.children)}}class V2C_SidebarView extends BDV2.reactComponent{constructor(o){super(o)}render(){let{sidebar:o,content:l,tools:d}=this.props.children;return BDV2.react.createElement("div",{className:"ui-standard-sidebar-view"},BDV2.react.createElement("div",{className:"sidebar-region"},BDV2.react.createElement(V2Components.Scroller,{key:"sidebarScroller",ref:"sidebarScroller",sidebar:!0,fade:o.fade||!0,dark:o.dark||!0,children:o.component})),BDV2.react.createElement("div",{className:"content-region"},BDV2.react.createElement("div",{className:"content-transition-wrap"},BDV2.react.createElement("div",{className:"scrollerWrap-2lJEkd content-region-scroller-wrap scrollerThemed-2oenus themeGhost-28MSn0 scrollerTrack-1ZIpsv"},BDV2.react.createElement("div",{className:"scroller-2FKFPG content-region-scroller scroller",ref:"contentScroller"},BDV2.react.createElement("div",{className:"content-column default"},l.component),d.component)))))}}class V2_PublicServers{constructor(){}get component(){return BDV2.react.createElement(V2Components.Layer,{rootId:"pubslayerroot",id:"pubslayer",children:BDV2.react.createElement(V2C_PublicServers,{rootId:"pubslayerroot"})})}get root(){let o=document.getElementById("pubslayerroot");return o?o:this.injectRoot()?this.root:null}injectRoot(){return!!$(".layers, .layers-3iHuyZ").length&&($(".layers, .layers-3iHuyZ").append($("<div/>",{id:"pubslayerroot"})),!0)}render(){let o=this.root;return o?void BDV2.reactDom.render(this.component,o):void console.log("FAILED TO LOCATE ROOT: .layers")}get button(){let o=$("<div/>",{"class":BDV2.guildClasses.guild,id:"bd-pub-li",css:{height:"20px",display:settingsCookie["bda-gs-1"]?"":"none"}}).append($("<div/>",{"class":BDV2.guildClasses.guildInner,css:{height:"20px","border-radius":"4px"}}).append($("<a/>",{}).append($("<div/>",{text:"public",id:"bd-pub-button",css:{"line-height":"20px","font-size":"12px"},click:()=>{this.render()}}))));return o}initialize(){let o=$(`.${BDV2.guildClasses.guilds}>:first-child`);o.after(this.button)}}class V2C_ServerCard extends BDV2.reactComponent{constructor(o){super(o),this.props.server.iconUrl||(this.props.server.iconUrl=this.props.fallback),this.state={imageError:!1,joined:this.props.guildList.includes(this.props.server.identifier)}}render(){let{server:o}=this.props;return BDV2.react.createElement("div",{className:`card-3Qj_Yx cardPrimary-1Hv-to marginBottom8-AtZOdT bd-server-card${o.pinned?" bd-server-card-pinned":""}`},BDV2.react.createElement("img",{ref:"img",className:"bd-server-image",src:o.iconUrl,onError:this.handleError.bind(this)}),BDV2.react.createElement("div",{className:"flexChild-faoVW3 bd-server-content"},BDV2.react.createElement("div",{className:"flex-1xMQg5 flex-1O1GKY horizontal-1ae9ci horizontal-2EEEnY directionRow-3v3tfG noWrap-3jynv6 bd-server-header"},BDV2.react.createElement("h5",{className:"h5-18_1nd defaultColor-1_ajX0 margin-reset bd-server-name"},o.name),BDV2.react.createElement("h5",{className:"h5-18_1nd defaultColor-1_ajX0 margin-reset bd-server-member-count"},o.members," Members")),BDV2.react.createElement("div",{className:"flex-1xMQg5 flex-1O1GKY horizontal-1ae9ci horizontal-2EEEnY directionRow-3v3tfG noWrap-3jynv6"},BDV2.react.createElement("div",{className:"scrollerWrap-2lJEkd scrollerThemed-2oenus themeGhostHairline-DBD-2d scrollerFade-1Ijw5y bd-server-description-container"},BDV2.react.createElement("div",{className:"scroller-2FKFPG scroller bd-server-description"},o.description))),BDV2.react.createElement("div",{className:"flex-1xMQg5 flex-1O1GKY horizontal-1ae9ci horizontal-2EEEnY directionRow-3v3tfG noWrap-3jynv6 bd-server-footer"},BDV2.react.createElement("div",{className:"flexChild-faoVW3 bd-server-tags",style:{flex:"1 1 auto"}},o.categories.join(", ")),this.state.joined&&BDV2.react.createElement("button",{type:"button",className:"button-38aScr lookFilled-1Gx00P colorBrand-3pXr91 sizeMin-1mJd1x grow-q77ONN colorGreen-29iAKY",style:{minHeight:"12px",marginTop:"4px",backgroundColor:"#3ac15c"}},BDV2.react.createElement("div",{className:"ui-button-contents"},"Joined")),o.error&&BDV2.react.createElement("button",{type:"button",className:"button-38aScr lookFilled-1Gx00P colorBrand-3pXr91 sizeMin-1mJd1x grow-q77ONN disabled-9aF2ug",style:{minHeight:"12px",marginTop:"4px",backgroundColor:"#c13a3a"}},BDV2.react.createElement("div",{className:"ui-button-contents"},"Error")),!o.error&&!this.state.joined&&BDV2.react.createElement("button",{type:"button",className:"button-38aScr lookFilled-1Gx00P colorBrand-3pXr91 sizeMin-1mJd1x grow-q77ONN",style:{minHeight:"12px",marginTop:"4px"},onClick:()=>{this.join()}},BDV2.react.createElement("div",{className:"ui-button-contents"},"Join")))))}handleError(){this.props.server.iconUrl=this.props.fallback,this.setState({imageError:!0})}join(){this.props.join(this)}}class V2C_PublicServers extends BDV2.reactComponent{constructor(o){super(o),this.setInitialState(),this.close=this.close.bind(this),this.changeCategory=this.changeCategory.bind(this),this.search=this.search.bind(this),this.searchKeyDown=this.searchKeyDown.bind(this),this.checkConnection=this.checkConnection.bind(this),this.join=this.join.bind(this),this.connect=this.connect.bind(this),this.GuildStore=BDV2.WebpackModules.findByUniqueProperties(["getGuilds"]),this.AvatarDefaults=BDV2.WebpackModules.findByUniqueProperties(["getUserAvatarURL","DEFAULT_AVATARS"]),this.InviteActions=BDV2.WebpackModules.findByUniqueProperties(["acceptInvite"]),this.SortedGuildStore=BDV2.WebpackModules.findByUniqueProperties(["getSortedGuilds"])}componentDidMount(){this.checkConnection()}setInitialState(){this.state={selectedCategory:-1,title:"Loading...",loading:!0,servers:[],next:null,connection:{state:0,user:null}}}close(){BDV2.reactDom.unmountComponentAtNode(document.getElementById(this.props.rootId))}search(o,l){let d=this;$.ajax({method:"GET",url:`${d.endPoint}${o}${o?"&schema=new":"?schema=new"}`,success:u=>{let h=u.results.reduce((E,C)=>{return C.joined=!1,E.push(C),E},[]);l||(h=d.state.servers.concat(h));let g=u.size+u.from;u.next=`?from=${g}`,d.state.term&&(u.next+=`&term=${d.state.term}`),d.state.selectedCategory&&(u.next+=`&category=${d.categoryButtons[d.state.selectedCategory]}`),g>=u.total&&(g=u.total,u.next=null);let y=`Showing 1-${g} of ${u.total} results in ${d.categoryButtons[d.state.selectedCategory]}`;d.state.term&&(y+=` for ${d.state.term}`),d.setState({loading:!1,title:y,servers:h,next:u.next}),l&&(d.refs.sbv.refs.contentScroller.scrollTop=0)},error:()=>{d.setState({loading:!1,title:"Failed to load servers. Check console for details"})}})}join(o){return o.props.pinned?this.InviteActions.acceptInvite(o.props.invite_code):void $.ajax({method:"GET",url:`${this.joinEndPoint}/${o.props.server.identifier}`,headers:{Accept:"application/json;","Content-Type":"application/json;","x-discord-id":this.state.connection.user.id,"x-discord-token":this.state.connection.user.accessToken},crossDomain:!0,xhrFields:{withCredentials:!0},success:()=>{o.setState({joined:!0})}})}connect(){let o=this,l=o.windowOptions;l.x=Math.round(window.screenX+window.innerWidth/2-l.width/2),l.y=Math.round(window.screenY+window.innerHeight/2-l.height/2),o.joinWindow=new(window.require("electron").remote.BrowserWindow)(l);let d=window.location.hostname.split(".")[0],u=o.connectEndPoint+("canary"===d||"ptb"===d?`/${d}`:"")+"?betterDiscord";o.joinWindow.webContents.on("did-navigate",(h,g)=>{"https://join.discordservers.com/session"!=g||(o.joinWindow.close(),o.checkConnection())}),o.joinWindow.loadURL(u)}get windowOptions(){return{width:500,height:550,backgroundColor:"#282b30",show:!0,resizable:!1,maximizable:!1,minimizable:!1,alwaysOnTop:!0,frame:!1,center:!1}}get bdServer(){let l=this.SortedGuildStore.guildPositions,d=this.AvatarDefaults.DEFAULT_AVATARS;return BDV2.react.createElement(V2Components.ServerCard,{server:{name:"BetterDiscord",online:"7500+",members:"20000+",categories:["community","programming","support"],description:"Official BetterDiscord server for support etc",identifier:"86004744966914048",iconUrl:"https://cdn.discordapp.com/icons/86004744966914048/292e7f6bfff2b71dfd13e508a859aedd.webp",nativejoin:!0,invite_code:"0Tmfo5ZbORCRqbAd",pinned:!0},pinned:!0,join:this.join,guildList:l,fallback:d[Math.floor(5*Math.random())]})}get endPoint(){return"https://search.discordservers.com"}get joinEndPoint(){return"https://join.discordservers.com"}get connectEndPoint(){return"https://join.discordservers.com/connect"}checkConnection(){let o=this;try{$.ajax({method:"GET",url:`${o.joinEndPoint}/session`,headers:{Accept:"application/json;","Content-Type":"application/json;"},crossDomain:!0,xhrFields:{withCredentials:!0},success:l=>{o.setState({selectedCategory:0,connection:{state:2,user:l}}),o.search("",!0)},error:l=>{if(403===l.status||404===l.status)return void o.setState({title:"Not connected to discordservers.com!",loading:!0,selectedCategory:-1,connection:{state:1,user:null}})}})}catch(l){o.setState({title:"Not connected to discordservers.com!",loading:!0,selectedCategory:-1,connection:{state:1,user:null}})}}render(){return BDV2.react.createElement(V2Components.SidebarView,{ref:"sbv",children:this.component})}get component(){return{sidebar:{component:this.sidebar},content:{component:this.content},tools:{component:BDV2.react.createElement(V2Components.Tools,{key:"pt",ref:"tools",onClick:this.close})}}}get sidebar(){return BDV2.react.createElement("div",{className:"sidebar",key:"ps"},BDV2.react.createElement("div",{className:"ui-tab-bar SIDE"},BDV2.react.createElement("div",{className:"ui-tab-bar-header",style:{fontSize:"16px"}},"Public Servers"),BDV2.react.createElement(V2Components.TabBar.Separator,null),this.searchInput,BDV2.react.createElement(V2Components.TabBar.Separator,null),BDV2.react.createElement(V2Components.TabBar.Header,{text:"Categories"}),this.categoryButtons.map((o,l)=>{return BDV2.react.createElement(V2Components.TabBar.Item,{id:l,onClick:this.changeCategory,key:l,text:o,selected:this.state.selectedCategory===l})}),BDV2.react.createElement(V2Components.TabBar.Separator,null),this.footer,this.connection))}get searchInput(){return BDV2.react.createElement("div",{className:"ui-form-item"},BDV2.react.createElement("div",{className:"ui-text-input flex-vertical",style:{width:"172px",marginLeft:"10px"}},BDV2.react.createElement("input",{ref:"searchinput",onKeyDown:this.searchKeyDown,onChange:()=>{},type:"text",className:"input default",placeholder:"Search...",maxLength:"50"})))}searchKeyDown(o){let l=this;if(!(l.state.loading||13!==o.which)){l.setState({loading:!0,title:"Loading...",term:o.target.value});let d=`?term=${o.target.value}`;0!==l.state.selectedCategory&&(d+=`&category=${l.categoryButtons[l.state.selectedCategory]}`),l.search(d,!0)}}get categoryButtons(){return["All","FPS Games","MMO Games","Strategy Games","Sports Games","Puzzle Games","Retro Games","Party Games","Tabletop Games","Sandbox Games","Simulation Games","Community","Language","Programming","Other"]}changeCategory(o){let l=this;if(!l.state.loading)return l.refs.searchinput.value="",l.setState({loading:!0,selectedCategory:o,title:"Loading...",term:null}),0===o?void l.search("",!0):void l.search(`?category=${l.categoryButtons[o]}`,!0)}get content(){let o=this,l=this.SortedGuildStore.guildPositions,d=this.AvatarDefaults.DEFAULT_AVATARS;return 1===o.state.connection.state?o.notConnected:[BDV2.react.createElement("div",{ref:"content",key:"pc",className:"content-column default"},BDV2.react.createElement(V2Components.SettingsTitle,{text:o.state.title}),o.bdServer,o.state.servers.map(u=>{return BDV2.react.createElement(V2Components.ServerCard,{key:u.identifier,server:u,join:o.join,guildList:l,fallback:d[Math.floor(5*Math.random())]})}),o.state.next&&BDV2.react.createElement("button",{type:"button",onClick:()=>{o.state.loading||(o.setState({loading:!0}),o.search(o.state.next,!1))},className:"ui-button filled brand small grow",style:{width:"100%",marginTop:"10px",marginBottom:"10px"}},BDV2.react.createElement("div",{className:"ui-button-contents"},o.state.loading?"Loading":"Load More")),0<o.state.servers.length&&BDV2.react.createElement(V2Components.SettingsTitle,{text:o.state.title}))]}get notConnected(){let o=this;return[BDV2.react.createElement("div",{key:"ncc",ref:"content",className:"content-column default"},BDV2.react.createElement("h2",{className:"ui-form-title h2 margin-reset margin-bottom-20"},"Not connected to discordservers.com!",BDV2.react.createElement("button",{onClick:o.connect,type:"button",className:"ui-button filled brand small grow",style:{display:"inline-block",minHeight:"18px",marginLeft:"10px",lineHeight:"14px"}},BDV2.react.createElement("div",{className:"ui-button-contents"},"Connect"))),o.bdServer)]}get footer(){return BDV2.react.createElement("div",{className:"ui-tab-bar-header"},BDV2.react.createElement("a",{href:"https://discordservers.com",target:"_blank"},"Discordservers.com"))}get connection(){let o=this,{connection:l}=o.state;return 2===l.state?BDV2.react.createElement("span",null,BDV2.react.createElement(V2Components.TabBar.Separator,null),BDV2.react.createElement("span",{style:{color:"#b9bbbe",fontSize:"10px",marginLeft:"10px"}},"Connected as: ",`${l.user.username}#${l.user.discriminator}`),BDV2.react.createElement("div",{style:{padding:"5px 10px 0 10px"}},BDV2.react.createElement("button",{style:{width:"100%",minHeight:"20px"},type:"button",className:"ui-button filled brand small grow"},BDV2.react.createElement("div",{className:"ui-button-contents",onClick:o.connect},"Reconnect")))):BDV2.react.createElement("span",null)}}